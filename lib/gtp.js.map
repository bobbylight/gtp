{"version":3,"sources":["src/gtp/BrowserUtil.ts","src/gtp/Utils.ts","src/gtp/_GameTimer.ts","src/gtp/ImageUtils.ts","src/gtp/Image.ts","src/gtp/SpriteSheet.ts","src/gtp/AssetType.ts","src/gtp/Sound.ts","src/gtp/Keys.ts","src/gtp/InputManager.ts","src/gtp/State.ts","src/gtp/Timer.ts","src/gtp/Game.ts","src/gtp/AudioSystem.ts","src/tiled/TiledTileset.ts","src/tiled/TiledObject.ts","src/tiled/TiledLayer.ts","src/tiled/TiledMap.ts","src/gtp/AssetLoader.ts","src/gtp/AssetLoader.spec.ts","src/gtp/BitmapFont.ts","src/gtp/Delay.ts","src/gtp/Delay.spec.ts","src/gtp/FadeOutInState.ts","src/gtp/FadeOutInState.spec.ts","src/gtp/Image.spec.ts","src/gtp/ImageAtlas.ts","src/gtp/Point.ts","src/gtp/Point.spec.ts","src/gtp/Pool.ts","src/gtp/Pool.spec.ts","src/gtp/Rectangle.ts","src/gtp/Rectangle.spec.ts","src/gtp/StretchMode.ts","src/gtp/Timer.spec.ts","src/gtp/Utils.spec.ts"],"names":[],"mappings":"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","file":"gtp.js","sourcesContent":["/**\r\n * Utility methods for interfacing with browser APIs.  This stuff is\r\n * typically hard to unit test, and thus is in this class so it is easily\r\n * mockable.\r\n *\r\n * @constructor\r\n */\r\nexport class BrowserUtil {\r\n\r\n\t/**\r\n\t * Returns <code>window.location.search</code>.\r\n\t */\r\n\tstatic getWindowLocationSearch(): string {\r\n\t\treturn window.location.search;\r\n\t}\r\n}\r\n","import {BrowserUtil} from './BrowserUtil';\r\n\r\n/**\r\n * Obligatory utility methods for games.\r\n * @constructor\r\n */\r\nexport class Utils {\r\n\r\n\t/**\r\n\t * Returns the number of elements in an object.\r\n\t *\r\n\t * @param {object} obj The object.\r\n\t * @return {int} The number of elements in the object.\r\n\t */\r\n\tstatic getObjectSize(obj: Object): number {\r\n\t\tlet size: number = 0;\r\n\t\tfor (let key in obj) {\r\n\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\tsize++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn size;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the value of a request parameter.\r\n\t *\r\n\t * @param {string} param The name of the request parameter.\r\n\t * @return {string} The value of the request parameter, or <code>null</code>\r\n\t *         if it was not specified.\r\n\t */\r\n\tstatic getRequestParam(param: string): string | null {\r\n\r\n\t\t// Replace leading '?' with '&'\r\n\t\tconst params: string = '&' + BrowserUtil.getWindowLocationSearch().substring(1);\r\n\r\n\t\tconst searchFor: string = '&' + param;\r\n\t\tconst index: number = params.indexOf(searchFor);\r\n\t\tif (index >= -1) {\r\n\t\t\tlet start: number = index + searchFor.length;\r\n\t\t\tif (params.charAt(start) === '=') {\r\n\t\t\t\tstart++;\r\n\t\t\t\tlet end: number = params.indexOf('&', start); // &foo=val1&bar=val2\r\n\t\t\t\tif (end === -1) {\r\n\t\t\t\t\tend = params.length; // &foo=val1\r\n\t\t\t\t}\r\n\t\t\t\treturn params.substring(start, end);\r\n\t\t\t}\r\n\t\t\telse if (params.charAt(start) === '&') {\r\n\t\t\t\treturn ''; // &foo&bar\r\n\t\t\t}\r\n\t\t\telse if (start === params.length) {\r\n\t\t\t\treturn ''; // &foo\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Equivalent to dojo/_base/hitch, returns a function in a specific scope.\r\n\t *\r\n\t * @param {object} scope The scope to run the function in (e.g. the value of\r\n\t *        \"this\").\r\n\t * @param {function} func The function.\r\n\t * @return {function} A function that does the same thing as 'func', but in the\r\n\t *         specified scope.\r\n\t */\r\n\tstatic hitch(scope: any, func: Function): Function {\r\n\t\t// \"arguments\" cannot be referenced in arrow functions\r\n\t\treturn function() { // tslint:disable-line:only-arrow-functions\r\n\t\t\tfunc.apply(scope, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Adds the properties of one element into another.\r\n\t *\r\n\t * @param {object} source The object with properties to mix into another object.\r\n\t * @param {object} target The object that will receive the new properties.\r\n\t */\r\n\tstatic mixin(source: any, target: any) {\r\n\t\tfor (let prop in source) {\r\n\t\t\tif (source.hasOwnProperty(prop)) {\r\n\t\t\t\t//if (!target[prop]) {\r\n\t\t\t\ttarget[prop] = source[prop];\r\n\t\t\t\t//}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a random integer between min (inclusive) and max (exclusive).  If\r\n\t * max is omitted, the single parameter is treated as the maximum value, and\r\n\t * an integer is returned in the range 0 - value.\r\n\t *\r\n\t * @param {int} [min=0] The minimum possible value, inclusive.\r\n\t * @param {int} max The maximum possible value, exclusive.\r\n\t * @return {int} The random integer value.\r\n\t */\r\n\tstatic randomInt(min: number, max: number): number;\r\n\tstatic randomInt(max: number): number;\r\n\tstatic randomInt(min: number, max?: number): number {\r\n\t\tlet realMin: number, realMax: number;\r\n\t\tif (typeof max === 'undefined') {\r\n\t\t\trealMin = 0;\r\n\t\t\trealMax = min;\r\n\t\t}\r\n\t\telse {\r\n\t\t\trealMin = min;\r\n\t\t\trealMax = max;\r\n\t\t}\r\n\t\t// Using Math.round() will give you a non-uniform distribution!\r\n\t\treturn Math.floor(Math.random() * (realMax - realMin)) + realMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a time in milliseconds.  This will be high resolution, if\r\n\t * possible.  This method should be used to implement constructs like\r\n\t * delays.\r\n\t * @return {number} A time, in milliseconds.\r\n\t */\r\n\tstatic timestamp(): number {\r\n\t\tif (window.performance && window.performance.now) {\r\n\t\t\treturn window.performance.now();\r\n\t\t}\r\n\t\treturn Date.now(); // IE < 10, PhantomJS 1.x, which is used by unit tests\r\n\t}\r\n\r\n\t/**\r\n\t * Defines console functions for IE9 and other braindead browsers.\r\n\t */\r\n\tstatic initConsole() {\r\n\t\t'use strict';\r\n\t\tif (!window.console) {\r\n\t\t\tconst noOp: Function = () => {};\r\n\t\t\t(<any>window).console = <any>{\r\n\t\t\t\tinfo: noOp,\r\n\t\t\t\tlog: noOp,\r\n\t\t\t\twarn: noOp,\r\n\t\t\t\t'error': noOp\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n","import {Utils} from './Utils';\n\n/**\n * This class keeps track of game time.  That includes both total running\n * time, and \"active time\" (time not spent on paused screens, etc.).\n * @constructor\n */\nexport class _GameTimer {\n\n\tprivate _startShift: number;\n\tprivate _paused: boolean;\n\tprivate _pauseStart: number;\n\tprivate _updating: boolean;\n\tprivate _notUpdatingStart: number;\n\n\tconstructor() {\n\t\tthis._paused = false;\n\t\tthis._pauseStart = 0;\n\t\tthis._updating = true;\n\t\tthis._notUpdatingStart = 0;\n\t}\n\n\t/**\n\t * Returns whether this game is paused.\n\t * @return {boolean} Whether this game is paused.\n\t */\n\tget paused(): boolean {\n\t\treturn this._paused;\n\t}\n\n\t/**\n\t * Returns the length of time the game has been played so far.  This is\n\t * \"playable time;\" that is, time in which the user is playing, and the\n\t * game is not paused or in a \"not updating\" state (such as the main\n\t * frame not having focus).\n\t *\n\t * @return {number} The amount of time the game has been played, in\n\t *         milliseconds.\n\t * @see resetPlayTime\n\t */\n\tget playTime(): number {\n\t\tif (this._pauseStart !== 0) {\n\t\t\treturn this._pauseStart - this._startShift;\n\t\t}\n\t\telse if (this._notUpdatingStart !== 0) {\n\t\t\treturn this._notUpdatingStart - this._startShift;\n\t\t}\n\t\treturn Utils.timestamp() - this._startShift;\n\t}\n\n\t/**\n\t * Returns whether this game is updating itself each frame.\n\t *\n\t * @return {boolean} Whether this game is updating itself.\n\t */\n\tget updating(): boolean {\n\t\treturn this._updating;\n\t}\n\n\t/**\n\t * Resets the \"playtime in milliseconds\" timer back to <code>0</code>.\n\t *\n\t * @see playTime\n\t */\n\tresetPlayTime() {\n\t\tif (this.paused || !this.updating) {\n\t\t\tthrow 'Cannot reset playtime millis when paused or not updating';\n\t\t}\n\t\tthis._startShift = Utils.timestamp();\n\t}\n\n\t/**\n\t * Sets whether the game is paused.  The game is still told to handle\n\t * input, update itself and render.  This is simply a flag that should\n\t * be set whenever a \"pause\" screen is displayed.  It stops the \"in-game\n\t * timer\" until the game is unpaused.\n\t *\n\t * @param paused Whether the game should be paused.\n\t * @see setUpdating\n\t */\n\tset paused(paused: boolean) {\n\t\t// Cannot pause while !updating, so this is okay\n\t\tif (this._paused !== paused) {\n\t\t\tthis._paused = paused;\n\t\t\tif (paused) {\n\t\t\t\tthis._pauseStart = Utils.timestamp();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst pauseTime: number = Utils.timestamp() - this._pauseStart;\n\t\t\t\tthis._startShift += pauseTime;\n\t\t\t\tthis._pauseStart = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets whether the game should be \"updating\" itself.  If a game is not\n\t * \"updating\" itself, then it is effectively \"paused,\" and will not accept\n\t * any input from the user.<p>\n\t *\n\t * This method can be used to temporarily \"pause\" a game when the game\n\t * window loses focus, for example.\n\t *\n\t * @param updating {boolean} Whether the game should be updating itself.\n\t */\n\tset updating(updating: boolean) {\n\t\tif (this._updating !== updating) {\n\t\t\tthis._updating = updating;\n\t\t\tif (!this.paused) { // \"pause\" state \"encompasses\" update state.\n\t\t\t\tif (!this._updating) {\n\t\t\t\t\tthis._notUpdatingStart = Utils.timestamp();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconst notUpdatingTime: number = Utils.timestamp() - this._notUpdatingStart;\n\t\t\t\t\tthis._startShift += notUpdatingTime;\n\t\t\t\t\tthis._notUpdatingStart = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Resets this timer.  This should be called when a new game is started.\n\t */\n\tstart() {\n\t\tthis._startShift = Utils.timestamp();\n\t}\n\n}\n","/**\r\n * General-purpose utilities for manipulating images in canvases.\r\n * @constructor\r\n */\r\nexport class ImageUtils {\r\n\r\n\t/**\r\n\t * If <code>true</code>, subpixel rendering is allowed; otherwise, x- and\r\n\t * y-coordinates are rounded to the nearest integer when rendering images.\r\n\t */\r\n\tstatic allowSubpixelImageRendering: boolean = false;\r\n\r\n\t/**\r\n\t * Takes an img/canvas and a scaling factor and returns the scaled image.\r\n\t * @method\r\n\t */\r\n\tstatic resize(img: HTMLImageElement|HTMLCanvasElement, scale: number = 1): HTMLCanvasElement {\r\n\r\n\t\t// The original image is drawn into an offscreen canvas of the same size\r\n\t\t// and copied, pixel by pixel into another offscreen canvas with the\r\n\t\t// new size.\r\n\r\n\t\tlet orig: HTMLCanvasElement,\r\n\t\t\torigCtx: CanvasRenderingContext2D;\r\n\r\n\t\tif (img instanceof HTMLImageElement) {\r\n\t\t\torig = ImageUtils.createCanvas(img.width, img.height);\r\n\t\t\torigCtx = orig.getContext('2d')!;\r\n\t\t\torigCtx.drawImage(img, 0, 0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\torig = <HTMLCanvasElement>img;\r\n\t\t\torigCtx = orig.getContext('2d')!;\r\n\t\t}\r\n\r\n\t\tif (scale === 1) {\r\n\t\t\treturn orig; // No reason to scale\r\n\t\t}\r\n\r\n\t\tconst origPixels: ImageData = origCtx.getImageData(0, 0, img.width, img.height);\r\n\r\n\t\tconst widthScaled: number = img.width * scale;\r\n\t\tconst heightScaled: number = img.height * scale;\r\n\t\tconst scaled: HTMLCanvasElement = ImageUtils.createCanvas(widthScaled, heightScaled);\r\n\t\tconst scaledCtx: CanvasRenderingContext2D = scaled.getContext('2d')!;\r\n\t\tconst scaledPixels: ImageData = scaledCtx.getImageData(0, 0, widthScaled, heightScaled);\r\n\r\n\t\tfor (let y: number = 0; y < heightScaled; y++) {\r\n\t\t\tfor (let x: number = 0; x < widthScaled; x++) {\r\n\t\t\t\tconst index: number = (Math.floor(y / scale) * img.width + Math.floor(x / scale)) * 4;\r\n\t\t\t\tconst indexScaled: number = (y * widthScaled + x) * 4;\r\n\t\t\t\tscaledPixels.data[indexScaled] = origPixels.data[index];\r\n\t\t\t\tscaledPixels.data[indexScaled + 1] = origPixels.data[index + 1];\r\n\t\t\t\tscaledPixels.data[indexScaled + 2] = origPixels.data[index + 2];\r\n\t\t\t\tscaledPixels.data[indexScaled + 3] = origPixels.data[index + 3];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tscaledCtx.putImageData(scaledPixels, 0, 0);\r\n\t\treturn scaled;\r\n\t}\r\n\r\n\tstatic createCanvas(width: number, height: number, parentDiv?: HTMLElement|string) {\r\n\r\n\t\tconst canvas: HTMLCanvasElement = document.createElement('canvas');\r\n\t\tcanvas.width = width;\r\n\t\tcanvas.height = height;\r\n\t\tImageUtils.prepCanvas(canvas);\r\n\r\n\t\tif (parentDiv) {\r\n\r\n\t\t\tlet actualParent: HTMLElement;\r\n\t\t\tif (typeof parentDiv === 'string') {\r\n\t\t\t\tactualParent = document.getElementById(parentDiv)!;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tactualParent = parentDiv;\r\n\t\t\t}\r\n\t\t\t// Clear previous contents in place there was a placeholder image\r\n\t\t\tactualParent.innerHTML = '';\r\n\t\t\tactualParent.appendChild(canvas);\r\n\t\t}\r\n\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\tstatic prepCanvas(canvas: HTMLCanvasElement) {\r\n\t\t// Use \"any\" instead of \"CanvasRenderingContext2D\" since  the TypeScript definition\r\n\t\t// files don't like the experimental *imageSmoothingEnabled properties\r\n\t\tconst ctx: any = canvas.getContext('2d');\r\n\t\tctx.imageSmoothingEnabled = false;\r\n\t\tctx.mozImageSmoothingEnabled = false;\r\n\t\tctx.oImageSmoothingEnabled = false;\r\n\t\tctx.webkitImageSmoothingEnabled = false;\r\n\t\tctx.msImageSmoothingEnabled = false;\r\n\r\n\t\t/* TODO: set imageRendering CSS properties based on some Game config property */\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a color of a particular type to completely transparent in a canvas.\r\n\t *\r\n\t * @param {Canvas} canvas The canvas to operate on.\r\n\t * @param {int} x The x-coordinate of the pixel whose color to change.  0 will\r\n\t *        be used if this parameter is undefined.\r\n\t * @param {int} y The y-coordinate of the pixel whose color to change.  0 will\r\n\t *        be used if this parameter is undefined.\r\n\t * @return {Canvas} The original canvas, which has been modified.\r\n\t * @method\r\n\t */\r\n\tstatic makeColorTranslucent(canvas: HTMLCanvasElement, x: number = 0, y: number = 0) {\r\n\r\n\t\tconst ctx: CanvasRenderingContext2D = canvas.getContext('2d')!;\r\n\t\tconst w: number = canvas.width;\r\n\t\tconst h: number = canvas.height;\r\n\t\tconst pixels: ImageData = ctx.getImageData(0, 0, w, h);\r\n\r\n\t\tconst color: number[] = [];\r\n\t\tconst offs: number = (y * w + x) * 4;\r\n\t\tfor (let i: number = 0; i < 4; i++) {\r\n\t\t\tcolor[i] = pixels.data[offs + i];\r\n\t\t}\r\n\r\n\t\tfor (y = 0; y < h; y++) {\r\n\t\t\tfor (x = 0; x < w; x++) {\r\n\t\t\t\tconst index: number = (y * w + x) * 4;\r\n\t\t\t\tif (pixels.data[index] === color[0] && pixels.data[index + 1] === color[1] &&\r\n\t\t\t\t\tpixels.data[index + 2] === color[2] && pixels.data[index + 3] === color[3]) {\r\n\t\t\t\t\tpixels.data[index] = 0;\r\n\t\t\t\t\tpixels.data[index + 1] = 0;\r\n\t\t\t\t\tpixels.data[index + 2] = 0;\r\n\t\t\t\t\tpixels.data[index + 3] = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tctx.putImageData(pixels, 0, 0);\r\n\t\treturn canvas;\r\n\t}\r\n}\r\n","import {ImageUtils} from './ImageUtils';\r\n\r\nexport class Image {\r\n\r\n\tprivate _canvas: HTMLCanvasElement;\r\n\tx: number;\r\n\ty: number;\r\n\tprivate _width: number;\r\n\tprivate _height: number;\r\n\r\n\t/**\r\n\t * A wrapper around images.  Handles browser-specific quirks and other things\r\n\t * a game shouldn't have to know about.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\tconstructor(canvas: HTMLCanvasElement, x?: number, y?: number, w?: number, h?: number) {\r\n\t\tthis._canvas = canvas;\r\n\t\tif (x != null && y != null && w != null && h != null) {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\tthis._width = w;\r\n\t\t\tthis._height = h;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.x = this.y = 0;\r\n\t\t\tthis._width = this._canvas.width;\r\n\t\t\tthis._height = this._canvas.height;\r\n\t\t}\r\n\t\tthis._ensure256Square();\r\n\t}\r\n\r\n\t/**\r\n\t * Chrome has trouble copying from a canvas in RAM to a canvas in GPU memory\r\n\t * and vice versa, unless all canvases are >= 256x256.\r\n\t */\r\n\t_ensure256Square() {\r\n\t\tif (this._canvas.width < 256 || this._canvas.height < 256) {\r\n\t\t\tconst w: number = Math.max(256, this._canvas.width);\r\n\t\t\tconst h: number = Math.max(256, this._canvas.height);\r\n\t\t\tconst canvas2: HTMLCanvasElement = ImageUtils.createCanvas(w, h);\r\n\t\t\tconst ctx2: CanvasRenderingContext2D = canvas2.getContext('2d')!;\r\n\t\t\tctx2.drawImage(this._canvas, 0, 0);\r\n\t\t\tthis._canvas = canvas2;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Draws this image.\r\n\t *\r\n\t * @param {CanvasRenderingContext2D} ctx A canvas' graphics context.\r\n\t * @param {int} x The x-coordinate at which to draw.\r\n\t * @param {int} y The y-coordinate at which to draw.\r\n\t */\r\n\tdraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n\t\tif (!ImageUtils.allowSubpixelImageRendering) {\r\n\t\t\tx = Math.round(x);\r\n\t\t\ty = Math.round(y);\r\n\t\t}\r\n\t\tctx.drawImage(this._canvas, this.x, this.y, this._width, this._height,\r\n\t\t\tx, y, this._width, this._height);\r\n\t}\r\n\r\n\t/**\r\n\t * Draws this image.\r\n\t *\r\n\t * @param {CanvasRenderingContext2D} ctx A canvas' graphics context.\r\n\t * @param {int} x The x-coordinate at which to draw.\r\n\t * @param {int} y The y-coordinate at which to draw.\r\n\t * @param {int} w The width to (possibly) stretch the image to when\r\n\t *              drawing.\r\n\t * @param {int} h The height to (possibly) stretch the image to when\r\n\t *              drawing.\r\n\t */\r\n\tdrawScaled(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) {\r\n\t\tif (!ImageUtils.allowSubpixelImageRendering) {\r\n\t\t\tx = Math.round(x);\r\n\t\t\ty = Math.round(y);\r\n\t\t}\r\n\t\tctx.drawImage(this._canvas, this.x, this.y, this._width, this._height,\r\n\t\t\tx, y, w, h);\r\n\t}\r\n\r\n\t/**\r\n\t * Draws this image.\r\n\t *\r\n\t * @param {CanvasRenderingContext2D} ctx A canvas' graphics context.\r\n\t * @param {int} srcX The x-coordinate at which to draw.\r\n\t * @param {int} srcY The y-coordinate at which to draw.\r\n\t * @param {int} srcW The width of the (possibly) sub-image to draw.\r\n\t * @param {int} srcH The height of the (possibly) sub-image to draw.\r\n\t * @param {int} destX The x-coordinate at which to draw.\r\n\t * @param {int} destY The y-coordinate at which to draw.\r\n\t * @param {int} destW The width to (possibly) stretch the image to when\r\n\t *              drawing.\r\n\t * @param {int} destH The height to (possibly) stretch the image to when\r\n\t *              drawing.\r\n\t */\r\n\tdrawScaled2(ctx: CanvasRenderingContext2D, srcX: number, srcY: number,\r\n\t\t\tsrcW: number, srcH: number,\r\n\t\t\tdestX: number, destY: number, destW: number, destH: number) {\r\n\r\n\t\tif (!ImageUtils.allowSubpixelImageRendering) {\r\n\t\t\tsrcX = Math.round(srcX);\r\n\t\t\tsrcY = Math.round(srcY);\r\n\t\t\tdestX = Math.round(destX);\r\n\t\t\tdestY = Math.round(destY);\r\n\t\t}\r\n\t\tsrcX = this.x + srcX;\r\n\t\tsrcY = this.y + srcY;\r\n\r\n\t\tctx.drawImage(this._canvas, srcX, srcY, srcW, srcH,\r\n\t\t\tdestX, destY, destW, destH);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a color of a particular type to completely transparent in this\r\n\t * image.\r\n\t *\r\n\t * @param {int} x The x-coordinate of the pixel whose color to change.  0 will\r\n\t *        be used if this parameter is undefined.\r\n\t * @param {int} y The y-coordinate of the pixel whose color to change.  0 will\r\n\t *        be used if this parameter is undefined.\r\n\t * @return {Image} This image, which has been modified.\r\n\t * @method\r\n\t */\r\n\tmakeColorTranslucent(x: number = 0, y: number = 0) {\r\n\t\tImageUtils.makeColorTranslucent(this._canvas, x, y);\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n}\r\n","import {Image} from './Image';\r\n\r\nexport class SpriteSheet {\r\n\r\n\tgtpImage: Image;\r\n\tcellW: number;\r\n\tcellH: number;\r\n\tspacingX: number;\r\n\tspacingY: number;\r\n\trowCount: number;\r\n\tcolCount: number;\r\n\tsize: number;\r\n\r\n\t/**\r\n\t * Creates a sprite sheet.\r\n\t *\r\n\t * @param {Image} gtpImage A GTP image that is the source for the sprite sheet.\r\n\t * @param {int} cellW The width of a cell in the sprite sheet.\r\n\t * @param {int} cellH The height of a cell in the sprite sheet.\r\n\t * @param {int} [spacing=1] Optional empty space between cells.\r\n\t * @param {int} [spacingY=spacing] Optional vertical empty space between cells.\r\n\t *        Specify only if different than the horizontal spacing.\r\n\t * @constructor\r\n\t */\r\n\tconstructor(gtpImage: Image, cellW: number, cellH: number,\r\n\t\tspacing: number = 1, spacingY: number = spacing) {\r\n\r\n\t\tthis.gtpImage = gtpImage;\r\n\t\tthis.cellW = cellW;\r\n\t\tthis.cellH = cellH;\r\n\t\tthis.spacingX = typeof spacing === 'undefined' ? 1 : spacing;\r\n\t\tthis.spacingY = typeof spacingY === 'undefined' ? this.spacingX : spacingY;\r\n\r\n\t\tthis.rowCount = Math.floor(gtpImage.height / (cellH + this.spacingY));\r\n\t\tif ((gtpImage.height - this.rowCount * (cellH + this.spacingY)) >= cellH) {\r\n\t\t\tthis.rowCount++;\r\n\t\t}\r\n\t\tthis.colCount = Math.floor(gtpImage.width / (cellW + this.spacingX));\r\n\t\tif ((gtpImage.width - this.colCount * (cellW + this.spacingX)) >= cellW) {\r\n\t\t\tthis.colCount++;\r\n\t\t}\r\n\r\n\t\tthis.size = this.rowCount * this.colCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Draws a sprite in this sprite sheet by row and column.\r\n\t * @param {CanvasRenderingContext2D} ctx The canvas' context.\r\n\t * @param {int} x The x-coordinate at which to draw.\r\n\t * @param {int} y The y-coordinate at which to draw.\r\n\t * @param {int} row The row in the sprite sheet of the sprite to draw.\r\n\t * @param {int} col The column in the sprite sheet of the sprite to draw.\r\n\t */\r\n\tdrawSprite(ctx: CanvasRenderingContext2D, x: number, y: number, row: number, col: number) {\r\n\t\tconst cellW: number = this.cellW;\r\n\t\tconst cellH: number = this.cellH;\r\n\t\tconst srcX: number = (cellW + this.spacingX) * col; //(col-1);\r\n\t\tconst srcY: number = (cellH + this.spacingY) * row; //(row-1);\r\n\t\t//ctx.drawImage(this.gtpImage.canvas, srcX,srcY,cellW,cellH, x,y,cellW,cellH);\r\n\t\tthis.gtpImage.drawScaled2(ctx, srcX, srcY, cellW, cellH, x, y, cellW, cellH);\r\n\t}\r\n\r\n\t/**\r\n\t * Draws a sprite in this sprite sheet by index\r\n\t * (<code>row*colCount + col</code>).\r\n\t * @param {CanvasRenderingContext2D} ctx The canvas' context.\r\n\t * @param {int} x The x-coordinate at which to draw.\r\n\t * @param {int} y The y-coordinate at which to draw.\r\n\t * @param {int} index The index in the sprite sheet of the sprite to draw.\r\n\t */\r\n\tdrawByIndex(ctx: CanvasRenderingContext2D, x: number, y: number, index: number) {\r\n\t\tconst row: number = Math.floor(index / this.colCount);\r\n\t\tconst col: number = Math.floor(index % this.colCount);\r\n\t\tthis.drawSprite(ctx, x, y, row, col);\r\n\t}\r\n\r\n}\r\n","export enum AssetType {\r\n\tUNKNOWN = 0,\r\n\tIMAGE = 1,\r\n\tAUDIO = 2,\r\n\tJSON = 3\r\n}\r\n","export class Sound {\r\n\r\n\tprivate _id: string;\r\n\tprivate _buffer: any;\r\n\tprivate _loopsByDefault: boolean;\r\n\tprivate _loopStart: number;\r\n\r\n\tconstructor(id: string, buffer: any, loopStart: number = 0) {\r\n\t\tthis._id = id;\r\n\t\tthis._buffer = buffer;\r\n\t\tthis._loopsByDefault = true;\r\n\t\tthis._loopStart = loopStart;\r\n\t}\r\n\r\n\tgetBuffer(): any {\r\n\t\treturn this._buffer;\r\n\t}\r\n\r\n\tgetId(): string {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tgetLoopsByDefaultIfMusic(): boolean {\r\n\t\treturn this._loopsByDefault;\r\n\t}\r\n\r\n\tsetLoopsByDefaultIfMusic(loopsByDefault: boolean) {\r\n\t\tthis._loopsByDefault = loopsByDefault;\r\n\t}\r\n\r\n\tgetLoopStart(): number {\r\n\t\treturn this._loopStart;\r\n\t}\r\n\r\n\tsetLoopStart(loopStart: number) {\r\n\t\tthis._loopStart = loopStart;\r\n\t}\r\n}\r\n","export enum Keys {\r\n\r\n\tKEY_ENTER = 13,\r\n\tKEY_SHIFT = 16,\r\n\tKEY_CTRL = 17,\r\n\tKEY_SPACE = 32,\r\n\tKEY_LEFT_ARROW = 37,\r\n\tKEY_UP_ARROW = 38,\r\n\tKEY_RIGHT_ARROW = 39,\r\n\tKEY_DOWN_ARROW = 40,\r\n\r\n\tKEY_0 = 48,\r\n\tKEY_1 = 49,\r\n\tKEY_2 = 50,\r\n\tKEY_3 = 51,\r\n\tKEY_4 = 52,\r\n\tKEY_5 = 53,\r\n\tKEY_6 = 54,\r\n\tKEY_7 = 55,\r\n\tKEY_8 = 56,\r\n\tKEY_9 = 57,\r\n\r\n\tKEY_A = 65,\r\n\tKEY_B = 66,\r\n\tKEY_C = 67,\r\n\tKEY_D = 68,\r\n\tKEY_E = 69,\r\n\tKEY_F = 70,\r\n\tKEY_G = 71,\r\n\tKEY_H = 72,\r\n\tKEY_I = 73,\r\n\tKEY_J = 74,\r\n\tKEY_K = 75,\r\n\tKEY_L = 76,\r\n\tKEY_M = 77,\r\n\tKEY_N = 78,\r\n\tKEY_O = 79,\r\n\tKEY_P = 80,\r\n\tKEY_Q = 81,\r\n\tKEY_R = 82,\r\n\tKEY_S = 83,\r\n\tKEY_T = 84,\r\n\tKEY_U = 85,\r\n\tKEY_V = 86,\r\n\tKEY_W = 87,\r\n\tKEY_X = 88,\r\n\tKEY_Y = 89,\r\n\tKEY_Z = 90\r\n\r\n}\r\n","import {Keys} from './Keys';\r\n\r\nexport class InputManager {\r\n\r\n\tprivate keys: boolean[];\r\n\tprivate _refireMillis: number;\r\n\tprivate _repeatTimers: { [key: number/*Keys*/]: any };\r\n\r\n\t/**\r\n\t * Handles input for games.<p>\r\n\t *\r\n\t * For keyboards, allows polling of individual key presses, both with and\r\n\t * without the keyboard repeat delay.<p>\r\n\t *\r\n\t * Touch and mouse input are currently not supported.\r\n\t *\r\n\t * @constructor\r\n\t * @param {int} [keyRefireMillis=0] What the key refiring time should be, in\r\n\t *        milliseconds.  A value of 0 means to take the operating system\r\n\t *        default.\r\n\t */\r\n\tconstructor(keyRefireMillis?: number) {\r\n\t\tthis.keys = [];\r\n\t\tthis._refireMillis = keyRefireMillis || 0;\r\n\t\tthis._repeatTimers = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Resets a specific key to its \"not depressed\" state.\r\n\t *\r\n\t * @param {int} key The key to reset.\r\n\t * @see clearKeyStates\r\n\t */\r\n\tclearKeyState(key: Keys) {\r\n\t\tthis.keys[key] = false;\r\n\t\tif (this._repeatTimers[key]) {\r\n\t\t\tclearInterval(this._repeatTimers[key]);\r\n\t\t\tthis._repeatTimers[key] = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Resets all keys to be in their \"not depressed\" states.\r\n\t */\r\n\tclearKeyStates() {\r\n\t\tfor (let i: number = 0; i < this.keys.length; i++) {\r\n\t\t\tthis.clearKeyState(i);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether ctrl is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tctrl(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_CTRL, clear);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether down is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tdown(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_DOWN_ARROW, clear);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether enter is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tenter(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_ENTER, clear);\r\n\t}\r\n\r\n\t/**\r\n\t * Installs this keyboard manager.  Should be called during game\r\n\t * initialization.\r\n\t */\r\n\tinstall() {\r\n\t\tdocument.onkeydown = (e: KeyboardEvent) => { this._keyDown(e); };\r\n\t\tdocument.onkeyup = (e:  KeyboardEvent) => { this._keyUp(e); };\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether a specific key is pressed.\r\n\t * @param keyCode {Keys} A key code.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tisKeyDown(keyCode: number, clear: boolean = false) {\r\n\t\tconst down: boolean = this.keys[keyCode];\r\n\t\tif (down && clear) {\r\n\t\t\tthis.keys[keyCode] = false;\r\n\t\t}\r\n\t\treturn down;\r\n\t}\r\n\r\n\t_keyDown(e: KeyboardEvent) {\r\n\t\tconst keyCode: number = e.keyCode;\r\n\t\tif (keyCode === 32 || (keyCode >= 37 && keyCode <= 40)) { // An arrow key or space\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\tif (this._refireMillis) {\r\n\t\t\tif (!this._repeatTimers[keyCode]) { // Only do on actual keydown, not key repeat\r\n\t\t\t\tthis.keys[keyCode] = true;\r\n\t\t\t\tthis._repeatTimers[keyCode] = setInterval(() => {\r\n\t\t\t\t\t//console.log('--- ' + new Date() + ': Setting keydown to true for: ' + keyCode + ', previous === ' + self.keys[keyCode]);\r\n\t\t\t\t\tthis.keys[keyCode] = true;\r\n\t\t\t\t}, this._refireMillis);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.keys[keyCode] = true;\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t}\r\n\r\n\t_keyUp(e: KeyboardEvent) {\r\n\t\tconst key: number = e.keyCode;\r\n\t\tif (this._refireMillis) {\r\n\t\t\tif (this._repeatTimers[key]) { // Should always be true\r\n\t\t\t\tthis.keys[key] = false;\r\n\t\t\t\tclearInterval(this._repeatTimers[key]);\r\n\t\t\t\tthis._repeatTimers[key] = null;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.error('_keyUp: Timer does not exist for key: ' + key + '!');\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.keys[key] = false;\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether left is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tleft(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_LEFT_ARROW, clear);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether right is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tright(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_RIGHT_ARROW, clear);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether shift is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tshift(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_SHIFT, clear);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether up is pressed.\r\n\t * @param clear {boolean} Whether the key's state should be reset to \"not\r\n\t *        pressed\" when this method returns.  This is useful to effectively\r\n\t *        enable the keyboard's buffering.\r\n\t * @return {boolean} Whether the key was pressed.\r\n\t */\r\n\tup(clear: boolean = false) {\r\n\t\treturn this.isKeyDown(Keys.KEY_UP_ARROW, clear);\r\n\t}\r\n}\r\n","import {Game} from './Game';\r\nimport {Window} from './GtpBase';\r\n\r\n/**\r\n * Arguments to pass to a state's constructor.\r\n */\r\nexport interface BaseStateArgs {\r\n\tgame: Game;\r\n}\r\n\r\n/**\r\n * A base class for game states.  Basically just an interface with callbacks\r\n * for updating and rendering, along with other lifecycle-ish methods.\r\n * @class\r\n */\r\nexport class State {\r\n\r\n\tgame: Game;\r\n\r\n\t/**\r\n\t * A base class for game states.  Basically just an interface with callbacks\r\n\t * for updating and rendering, along with other lifecycle-ish methods.\r\n\t * @class\r\n\t * @constructor\r\n\t * @param args Arguments to the game state.\r\n\t */\r\n\tconstructor(args?: Game|BaseStateArgs) {\r\n\t\tif (args && args instanceof Game) {\r\n\t\t\tthis.game = args;\r\n\t\t}\r\n\t\telse if (args) {\r\n\t\t\tthis.game = (<BaseStateArgs>args).game;\r\n\t\t}\r\n\t\telse { // Default to global game object\r\n\t\t\tconst gameWindow: Window = <any>window;\r\n\t\t\tthis.game = gameWindow.game;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Called right before a state starts.  Subclasses can do any needed\r\n\t * initialization here.\r\n\t * @param {Game} game The game being played.\r\n\t * @see leaving\r\n\t */\r\n\tenter(game: Game) {\r\n\t\t// Subclasses can override\r\n\t}\r\n\r\n\t/**\r\n\t * Called when this state is being left for another one.\r\n\t * @param {Game} game The game being played.\r\n\t * @see enter\r\n\t */\r\n\tleaving(game: Game) {\r\n\t}\r\n\r\n\t/**\r\n\t * Subclasses should override this method to do necessary update logic.\r\n\t *\r\n\t * @param {number} delta The amount of time that has elapsed since the last\r\n\t *        frame/call to this method, as a floating point number.\r\n\t */\r\n\tupdate(delta: number) {\r\n\t\t// Subclasses should override\r\n\t}\r\n\r\n\t/**\r\n\t * Subclasses should override this method to render the screen.\r\n\t *\r\n\t * @param {CanvasRenderingContext2D} ctx The graphics context to render onto.\r\n\t */\r\n\trender(ctx: CanvasRenderingContext2D) {\r\n\t\t// Subclasses should override\r\n\t}\r\n}\r\n","import {Utils} from './Utils';\r\n\r\n/**\r\n * A mapping from string keys to numbers.  Used to map named events to their\r\n * run times.\r\n */\r\ninterface TimeMap {\r\n\t[key: string]: number;\r\n}\r\n\r\nexport class Timer {\r\n\r\n\tprivate _startTimes: TimeMap = {};\r\n\tprivate _prefix: string = 'DEBUG';\r\n\r\n\t/**\r\n\t * Allows you to time actions and log their runtimes to the console.\r\n\t * @constructor\r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the prefix to prepend to each line printed to the console.\r\n\t *\r\n\t * @param {String} prefix The new prefix.  'DEBUG' is used if not defined.\r\n\t */\r\n\tsetLogPrefix(prefix: string = 'DEBUG') {\r\n\t\tthis._prefix = prefix;\r\n\t}\r\n\r\n\t/**\r\n\t * Starts timing something.\r\n\t *\r\n\t * @param {String} key A unique key for the thing being timed.\r\n\t */\r\n\tstart(key: string) {\r\n\t\tthis._startTimes[key] = Utils.timestamp();\r\n\t}\r\n\r\n\t/**\r\n\t * Stops timing something.\r\n\t *\r\n\t * @param {String} key The key of the thing being timed.\r\n\t */\r\n\tend(key: string) {\r\n\t\tconst start: number = this._startTimes[key];\r\n\t\tif (!start) {\r\n\t\t\tconsole.error('Cannot end timer for \"' + key + '\" as it was never started');\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tconst time: number = Utils.timestamp() - start;\r\n\t\tdelete this._startTimes[key];\r\n\t\treturn time;\r\n\t}\r\n\r\n\t/**\r\n\t * Stops timing something and logs its runtime to the console.\r\n\t *\r\n\t * @param {String} key The key of the thing being timed.\r\n\t */\r\n\tendAndLog(key: string) {\r\n\t\tconst time: number = this.end(key);\r\n\t\tif (time > -1) {\r\n\t\t\tconsole.log(this._prefix + ': ' + key + ': ' + time + ' ms');\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import {Keys} from './Keys';\r\nimport {InputManager} from './InputManager';\r\nimport {State} from './State';\r\nimport {_GameTimer} from './_GameTimer';\r\nimport {Timer} from './Timer';\r\nimport {ImageUtils} from './ImageUtils';\r\nimport {Utils} from './Utils';\r\nimport {AudioSystem} from './AudioSystem';\r\nimport {AssetLoader} from './AssetLoader';\r\n\r\n/**\r\n * A base class for a game.\r\n *\r\n * @constructor\r\n */\r\nexport class Game {\r\n\r\n\t/*private */_scale: number;\r\n\tcanvas: HTMLCanvasElement;\r\n\tinputManager: InputManager;\r\n\t_targetFps: number;\r\n\t_interval: number;\r\n\tlastTime: number;\r\n\taudio: AudioSystem;\r\n\tassets: AssetLoader;\r\n\tclearScreenColor: string;\r\n\tfpsColor: string;\r\n\tstatusMessageRGB: string;\r\n\tprivate _statusMessageColor: string | null;\r\n\tshowFps: boolean;\r\n\tframes: number;\r\n\tprivate _fpsMsg: string;\r\n\tprivate _statusMessage: string | null;\r\n\tprivate _statusMessageAlpha: number;\r\n\tprivate _statusMessageTime: number;\r\n\tstate: State;\r\n\tprivate _gameTimer: _GameTimer;\r\n\ttimer: Timer;\r\n\r\n\tconstructor(args: any = {}) {\r\n\r\n\t\tUtils.initConsole();\r\n\r\n\t\tthis._scale = args.scale || 1;\r\n\t\tthis.canvas = ImageUtils.createCanvas(args.width, args.height, args.parent);\r\n\r\n\t\tthis.inputManager = new InputManager(args.keyRefreshMillis || 0);\r\n\t\tthis.inputManager.install();\r\n\t\tthis._targetFps = args.targetFps || 30;\r\n\t\tthis._interval = 1000 / this._targetFps;\r\n\t\tthis.lastTime = 0;\r\n\r\n\t\tthis.audio = new AudioSystem();\r\n\t\tthis.audio.init();\r\n\t\tconst assetPrefix: string = args.assetRoot || null;\r\n\t\tthis.assets = new AssetLoader(this._scale, this.audio, assetPrefix);\r\n\r\n\t\tthis.clearScreenColor = 'rgb(0,0,0)';\r\n\r\n\t\tthis.fpsColor = 'rgb(255,255,255)';\r\n\t\tthis.statusMessageRGB = '255,255,255';\r\n\t\tthis._statusMessageColor = null;\r\n\t\tthis.showFps = false;\r\n\t\tthis.frames = 0;\r\n\t\tthis._fpsMsg = this._targetFps + ' fps';\r\n\t\tthis._statusMessage = null;\r\n\t\tthis._statusMessageAlpha = 0;\r\n\r\n\t\tthis._gameTimer = new _GameTimer();\r\n\t\tthis.timer = new Timer();\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the screen.\r\n\t * @param {string} clearScreenColor The color to clear the screen with.\r\n\t *        If unspecified, <code>this.clearScreenColor</code> is used.\r\n\t */\r\n\tclearScreen(clearScreenColor: string = this.clearScreenColor) {\r\n\t\tconst ctx: CanvasRenderingContext2D = this.canvas.getContext('2d')!;\r\n\t\tctx.fillStyle = clearScreenColor;\r\n\t\tctx.fillRect(0, 0, this.getWidth(), this.getHeight());\r\n\t}\r\n\r\n\tgetHeight(): number {\r\n\t\treturn this.canvas.height;\r\n\t}\r\n\r\n\tgetWidth(): number {\r\n\t\treturn this.canvas.width;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this game is paused.\r\n\t * @return {boolean} Whether this game is paused.\r\n\t */\r\n\tget paused(): boolean {\r\n\t\treturn this._gameTimer.paused;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the length of time the game has been played so far.  This is\r\n\t * \"playable time;\" that is, time in which the user is playing, and the\r\n\t * game is not paused or in a \"not updating\" state (such as the main\r\n\t * frame not having focus).\r\n\t *\r\n\t * @return The amount of time the game has been played, in milliseconds.\r\n\t * @see resetPlayTime\r\n\t */\r\n\tget playTime(): number {\r\n\t\treturn this._gameTimer.playTime;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a random number between <code>0</code> and\r\n\t * <code>number</code>, exclusive.\r\n\t *\r\n\t * @param max {number} The upper bound, exclusive.\r\n\t * @return {number} The random number.\r\n\t */\r\n\trandomInt(max: number): number {\r\n\t\tconst min: number = 0;\r\n\t\t// Using Math.round() would give a non-uniform distribution!\r\n\t\treturn Math.floor(Math.random() * (max - min + 1) + min);\r\n\t}\r\n\r\n\trender() {\r\n\r\n\t\tconst ctx: CanvasRenderingContext2D = this.canvas.getContext('2d')!;\r\n\t\tthis.state.render(ctx);\r\n\r\n\t\tif (this.showFps) {\r\n\t\t\tthis._renderFps(ctx);\r\n\t\t}\r\n\t\tif (this._statusMessage && this._statusMessageAlpha > 0) {\r\n\t\t\tthis._renderStatusMessage(ctx);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _renderFps(ctx: CanvasRenderingContext2D) {\r\n\r\n\t\tthis.frames++;\r\n\t\tconst now: number = Utils.timestamp();\r\n\t\tif (this.lastTime === null) {\r\n\t\t\tthis.lastTime = now;\r\n\t\t}\r\n\t\telse if (now - this.lastTime >= 1000) {\r\n\t\t\tthis._fpsMsg = this.frames + ' fps';\r\n\t\t\tthis.frames = 0;\r\n\t\t\tthis.lastTime = now;\r\n\t\t}\r\n\r\n\t\tconst x: number = 10;\r\n\t\tconst y: number = 15;\r\n\t\tctx.font = '10pt Arial';\r\n\t\tctx.fillStyle = this.fpsColor;\r\n\t\tctx.fillText(this._fpsMsg, x, y);\r\n\r\n\t}\r\n\r\n\tprivate _renderStatusMessage(ctx: CanvasRenderingContext2D) {\r\n\t\tif (this._statusMessage) {\r\n\t\t\tconst x: number = 10;\r\n\t\t\tconst y: number = this.canvas.height - 6;\r\n\t\t\tctx.font = '10pt Arial';\r\n\t\t\tctx.fillStyle = this._statusMessageColor || '#fff';\r\n\t\t\tctx.fillText(this._statusMessage, x, y);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the \"playtime in milliseconds\" timer back to <code>0</code>.\r\n\t *\r\n\t * @see playTimeMillis\r\n\t */\r\n\tresetPlayTime() {\r\n\t\tthis._gameTimer.resetPlayTime();\r\n\t}\r\n\r\n  /**\r\n   * Sets whether the game is paused.  The game is still told to handle\r\n   * input, update itself and render.  This is simply a flag that should\r\n   * be set whenever a \"pause\" screen is displayed.  It stops the \"in-game\r\n   * timer\" until the game is unpaused.\r\n   *\r\n   * @param paused Whether the game should be paused.\r\n   */\r\n\tset paused(paused: boolean) {\r\n\t\tif (paused) {\r\n\t\t\tthis.audio.pauseAll();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.audio.resumeAll();\r\n\t\t}\r\n\t\tthis._gameTimer.paused = paused;\r\n\t}\r\n\r\n\tsetState(state: State) {\r\n\t\tif (this.state) {\r\n\t\t\tthis.state.leaving(this);\r\n\t\t}\r\n\t\tthis.state = state;\r\n\t\tthis.state.enter(this);\r\n\t}\r\n\r\n\tsetStatusMessage(message: string) {\r\n\t\tthis._statusMessage = message;\r\n\t\tthis._statusMessageAlpha = 2.0; // 1.0 of message, 1.0 of fading out\r\n\t\tthis._statusMessageTime = Utils.timestamp() + 100;\r\n\t}\r\n\r\n\t/**\r\n\t * Starts the game loop.\r\n\t */\r\n\tstart() {\r\n\t\tconst callback: Function = Utils.hitch(this, this._tick);\r\n\t\tthis._gameTimer.start();\r\n\t\tsetInterval(callback, this._interval);\r\n\t}\r\n\r\n\tprivate _tick() {\r\n\r\n\t\tif (this._statusMessage) {\r\n\t\t\tconst time: number = Utils.timestamp();\r\n\t\t\tif (time > this._statusMessageTime) {\r\n\t\t\t\tthis._statusMessageTime = time + 100;\r\n\t\t\t\tthis._statusMessageAlpha -= 0.1;\r\n\t\t\t\tconst alpha: number = Math.min(1, this._statusMessageAlpha);\r\n\t\t\t\tthis._statusMessageColor = 'rgba(' + this.statusMessageRGB + ',' + alpha + ')';\r\n\t\t\t\tif (this._statusMessageAlpha <= 0) {\r\n\t\t\t\t\tthis._statusMessage = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\ttoggleMuted(): boolean {\r\n\t\tlet muted: boolean = this.audio.toggleMuted();\r\n\t\tthis.setStatusMessage(muted ? 'Audio muted' : 'Audio enabled');\r\n\t\treturn muted;\r\n\t}\r\n\r\n\ttoggleShowFps() {\r\n\t\tthis.showFps = !this.showFps;\r\n\t\tthis.setStatusMessage('FPS display: ' + (this.showFps ? 'on' : 'off'));\r\n\t}\r\n\r\n\t/**\r\n\t * Called during each tick to update game logic.  The default implementation\r\n\t * checks for a shortcut key to toggle the FPS display before delegating to\r\n\t * the current game state.  Subclasses can override, but typically update\r\n\t * logic is handled by game states.\r\n\t */\r\n\tupdate() {\r\n\r\n\t\tconst im: InputManager = this.inputManager;\r\n\t\tif (im.isKeyDown(Keys.KEY_SHIFT)) {\r\n\r\n\t\t\tif (im.isKeyDown(Keys.KEY_F, true)) {\r\n\t\t\t\tthis.toggleShowFps();\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tthis.state.update(this._interval);\r\n\r\n\t}\r\n\r\n}\r\n","import {Sound} from './Sound';\r\nimport {Window} from './GtpBase';\r\n\r\ninterface _PlayingSoundConfig {\r\n\taudioSystem: AudioSystem;\r\n\tid: number;\r\n\tsoundId: string;\r\n\tloop: boolean;\r\n\tbuffer: AudioBuffer;\r\n\tconnectTo: AudioNode|AudioNode[];\r\n\tonendedGenerator: Function;\r\n\tstartOffset?: number;\r\n}\r\n\r\n/**\r\n * A sound effect that is currently being played.\r\n */\r\nclass PlayingSound {\r\n\r\n\tid: number;\r\n\tsoundId: string;\r\n\tsource: AudioBufferSourceNode;\r\n\t_config: _PlayingSoundConfig;\r\n\t_startOffset: number;\r\n\t_paused: boolean;\r\n\t_start: number;\r\n\t_playedTime: number;\r\n\r\n\tconstructor(config: _PlayingSoundConfig) {\r\n\t\tthis._config = config;\r\n\t\tthis._paused = false;\r\n\t}\r\n\r\n\tprivate _initFromConfig() {\r\n\r\n\t\tthis.id = this._config.id;\r\n\t\tthis.soundId = this._config.soundId;\r\n\r\n\t\tthis.source = this._config.audioSystem.context.createBufferSource();\r\n\t\tthis.source.loop = this._config.loop;\r\n\t\tthis.source.buffer = this._config.buffer;\r\n\t\tif (this._config.connectTo instanceof AudioNode) {\r\n\t\t\tthis.source.connect(<AudioNode>this._config.connectTo);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet nodes: AudioNode[] = <AudioNode[]>this._config.connectTo;\r\n\t\t\tnodes.forEach((node: AudioNode) => {\r\n\t\t\t\tthis.source.connect(node);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._startOffset = this._config.startOffset || 0;\r\n\r\n\t\tif (!this._config.loop) {\r\n\t\t\tthis.source.onended = this._config.onendedGenerator(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\tpause() {\r\n\t\tif (!this._paused) {\r\n\t\t\tthis.source.stop();\r\n\t\t\tthis._playedTime += this.source.context.currentTime - this._start;\r\n\t\t\tthis._paused = true;\r\n\t\t\tthis._start = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tif (this._paused) {\r\n\t\t\tthis._paused = false;\r\n\t\t\tlet prevStartOffset: number = this._startOffset;\r\n\t\t\tthis._initFromConfig();\r\n\t\t\tthis._startOffset = prevStartOffset + this._playedTime;\r\n\t\t\tthis._startOffset = this._startOffset % this.source.buffer!.duration;\r\n\t\t\tlet curAudioTime: number = this.source.context.currentTime;\r\n\t\t\tthis.source.start(curAudioTime, this._startOffset);\r\n\t\t\tthis._start = curAudioTime;\r\n\t\t\tthis._playedTime = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis._paused = false;\r\n\t\tthis._initFromConfig();\r\n\t\tlet curAudioTime: number = this.source.context.currentTime;\r\n\t\tthis.source.start(curAudioTime, this._startOffset);\r\n\t\tthis._start = curAudioTime;\r\n\t\tthis._playedTime = 0;\r\n\t}\r\n\r\n}\r\n\r\nexport class AudioSystem {\r\n\r\n\tprivate _currentMusic: AudioBufferSourceNode | null;\r\n\tprivate _sounds: { [id: string]: Sound };\r\n\tprivate _musicFade: number;\r\n\tprivate _fadeMusic: boolean;\r\n\tprivate _muted: boolean;\r\n\tprivate _initialized: boolean;\r\n\r\n\tcontext: AudioContext;\r\n\tprivate _volumeFaderGain: GainNode;\r\n\tprivate _musicFaderGain: GainNode;\r\n\tprivate currentMusicId: string;\r\n\tprivate _musicLoopStart: number;\r\n\r\n\t/**\r\n\t * A list of all sound effects currently being played.  If a sound effect\r\n\t * is not looping (which is likely typical), it will be removed from this\r\n\t * list when it completes.  This data structure allows us to pause all sound\r\n\t * effects at the same time.\r\n\t */\r\n\tprivate _playingSounds: PlayingSound[];\r\n\r\n\t/**\r\n\t * Used to give all playing sound effects unique ids.\r\n\t */\r\n\tprivate _soundEffectIdGenerator: number;\r\n\r\n\t/**\r\n\t * A wrapper around web audio for games.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tthis._currentMusic = null;\r\n\t\tthis._sounds = {};\r\n\t\tthis._musicFade = 0.3; // seconds\r\n\t\tthis._fadeMusic = true;\r\n\t\tthis._muted = false;\r\n\t\tthis._playingSounds = [];\r\n\t\tthis._soundEffectIdGenerator = 0;\r\n\t}\r\n\r\n\tprivate _createPlayingSound(id: string, loop: boolean = false,\r\n\t\t\tstartOffset: number = 0, doneCallback?: Function): PlayingSound {\r\n\r\n\t\tconst soundEffectId: number = this._createSoundEffectId();\r\n\r\n\t\tconst soundEffect: PlayingSound = new PlayingSound({\r\n\t\t\taudioSystem: this,\r\n\t\t\tbuffer: this._sounds[id].getBuffer(),\r\n\t\t\tconnectTo: this._volumeFaderGain,\r\n\t\t\tid: soundEffectId,\r\n\t\t\tloop: loop,\r\n\t\t\tonendedGenerator: (playingSoundId: number) => {\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\tthis._removePlayingSound(playingSoundId);\r\n\t\t\t\t\tif (doneCallback) {\r\n\t\t\t\t\t\tdoneCallback(soundEffectId, id);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tsoundId: id,\r\n\t\t\tstartOffset: startOffset,\r\n\t\t});\r\n\t\treturn soundEffect;\r\n\t}\r\n\r\n\tprivate _createSoundEffectId(): number {\r\n\t\treturn this._soundEffectIdGenerator++;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the audio system.\r\n\t */\r\n\tinit() {\r\n\r\n\t\t// Effectively cast to our window extension for static typing\r\n\t\tconst w: Window = <any>window;\r\n\r\n\t\ttry {\r\n\t\t\tw.AudioContext = w.AudioContext || w.webkitAudioContext;\r\n\t\t\tthis.context = new w.AudioContext();\r\n\t\t\tthis._volumeFaderGain = this.context.createGain();\r\n\t\t\tthis._volumeFaderGain.gain.setValueAtTime(1, this.context.currentTime);\r\n\t\t\tthis._volumeFaderGain.gain.value = 1;\r\n\t\t\tthis._volumeFaderGain.connect(this.context.destination);\r\n\t\t\tthis._initialized = true;\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('The Web Audio API is not supported in this browser.');\r\n\t\t\tthis._initialized = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a sound for later playback.\r\n\t * @param sound {Sound} The sound.\r\n\t */\r\n\taddSound(sound: Sound) {\r\n\t\tif (this.context) {\r\n\t\t\tthis._sounds[sound.getId()] = sound;\r\n\t\t}\r\n\t}\r\n\r\n\tfadeOutMusic(newMusicId: string) {\r\n\r\n\t\tif (this.context) {\r\n\t\t\tif (this._currentMusic) {\r\n\t\t\t\tif (!this._muted) {\r\n\t\t\t\t\t// We must \"anchor\" via setValueAtTime() before calling a *rampToValue() method (???)\r\n\t\t\t\t\tthis._musicFaderGain.gain.setValueAtTime(this._musicFaderGain.gain.value, this.context.currentTime);\r\n\t\t\t\t\tthis._musicFaderGain.gain.linearRampToValueAtTime(0, this.context.currentTime + this._musicFade);\r\n\t\t\t\t}\r\n\t\t\t\tconst that: AudioSystem = this;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthat.playMusic(newMusicId);\r\n\t\t\t\t}, this._musicFade * 1000);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.playMusic(newMusicId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the ID of the current music being played.\r\n\t *\r\n\t * @return {string} The current music's ID.\r\n\t * @see playMusic\r\n\t * @see stopMusic\r\n\t */\r\n\tgetCurrentMusic(): string {\r\n\t\treturn this.currentMusicId;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether the audio system initialized properly.  This will return\r\n\t * false if the user's browser does not support the web audio API.\r\n\t * @return {boolean} Whether the sound system is initialized\r\n\t */\r\n\tisInitialized(): boolean {\r\n\t\treturn this._initialized;\r\n\t}\r\n\r\n\t/**\r\n\t * Pauses all music and sound effects.\r\n\t * @see resumeAll\r\n\t */\r\n\tpauseAll() {\r\n\t\tthis._playingSounds.forEach((sound: PlayingSound) => {\r\n\t\t\tsound.pause();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Plays a specific sound as background music.  Only one \"music\" can play\r\n\t * at a time, as opposed to \"sounds,\" of which multiple can be playing at\r\n\t * one time.\r\n\t * @param {string} id The ID of the resource to play as music.  If this is\r\n\t *        <code>null</code>, the current music is stopped but no new music\r\n\t *        is started.\r\n\t * @param {boolean} loop Whether the music should loop.\r\n\t * @see stopMusic\r\n\t */\r\n\tplayMusic(id: string, loop?: boolean) {\r\n\r\n\t\tif (this.context) {\r\n\r\n\t\t\t// Note: We destroy and recreate _musicFaderGain each time, because\r\n\t\t\t// it appears to occasionally start playing muted if we do not do\r\n\t\t\t// so, even when gain.value===1, on Chrome 38.\r\n\t\t\tif (this._currentMusic) {\r\n\t\t\t\tthis.stopMusic(false);\r\n\t\t\t}\r\n\r\n\t\t\tif (!id) {\r\n\t\t\t\treturn; // null id => don't play any music\r\n\t\t\t}\r\n\t\t\tconst sound: Sound = this._sounds[id];\r\n\t\t\tif (typeof loop === 'undefined') {\r\n\t\t\t\tloop = sound.getLoopsByDefaultIfMusic();\r\n\t\t\t}\r\n\r\n\t\t\tthis._musicFaderGain = this.context.createGain();\r\n\t\t\tthis._musicFaderGain.gain.setValueAtTime(1, this.context.currentTime);\r\n\t\t\tthis._musicFaderGain.gain.value = 1;\r\n\t\t\tthis._currentMusic = this.context.createBufferSource();\r\n\t\t\tthis._currentMusic.loop = loop;\r\n\t\t\tthis._musicLoopStart = sound.getLoopStart() || 0;\r\n\t\t\tthis._currentMusic.loopStart = this._musicLoopStart;\r\n\t\t\tthis._currentMusic.buffer = sound.getBuffer();\r\n\t\t\tthis._currentMusic.loopEnd = this._currentMusic.buffer!.duration;\r\n\t\t\tthis._currentMusic.connect(this._musicFaderGain);\r\n\t\t\tthis._musicFaderGain.connect(this._volumeFaderGain);\r\n\t\t\tthis._currentMusic.start(0);\r\n\t\t\tthis.currentMusicId = id;\r\n\t\t\tconsole.log('Just started new music with id: ' + id + ', loop: ' + loop);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Plays the sound with the given ID.\r\n\t * @param {string} id The ID of the resource to play.\r\n\t * @param {boolean} loop Whether the music should loop.  Defaults to\r\n\t *        <code>false</code>.\r\n\t * @param {Function} doneCallback An optional callback to call when the\r\n\t *        sound completes. This callback will receive the returned numeric\r\n\t *        ID as a parameter.  This parameter is ignored if <code>loop</code>\r\n\t *        is <code>true</code>.\r\n\t * @return {number} An ID for the playing sound.  This can be used to\r\n\t *         stop a looping sound via <code>stopSound(id)</code>.\r\n\t * @see stopSound\r\n\t */\r\n\tplaySound(id: string, loop: boolean = false, doneCallback?: Function): number {\r\n\t\tif (this.context) {\r\n\r\n\t\t\tlet playingSound: PlayingSound = this._createPlayingSound(id, loop, 0,\r\n\t\t\t\t\tdoneCallback);\r\n\t\t\tthis._playingSounds.push(playingSound);\r\n\t\t\tplayingSound.start();\r\n\t\t\treturn playingSound.id;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a sound from our list of currently-being-played sound effects.\r\n\t * @param {number} id The sound effect to stop playing.\r\n\t * @return The sound just removed, or <code>null</code> if there was no such sound.\r\n\t */\r\n\tprivate _removePlayingSound(id: number): PlayingSound | null {\r\n\t\tfor (let i: number = 0; i < this._playingSounds.length; i++) {\r\n\t\t\tif (this._playingSounds[i].id === id) {\r\n\t\t\t\tlet sound: PlayingSound = this._playingSounds[i];\r\n\t\t\t\tthis._playingSounds.splice(i, 1);\r\n\t\t\t\treturn sound;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Resumes all music and sound effects.\r\n\t * @see pauseAll\r\n\t */\r\n\tresumeAll() {\r\n\r\n\t\tfor (let i: number = 0; i < this._playingSounds.length; i++) {\r\n\t\t\tlet sound: PlayingSound = this._playingSounds[i];\r\n\t\t\tif (sound._paused) {\r\n\t\t\t\tsound.resume();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the currently playing music, if any.\r\n\t * @param {boolean} pause If <code>true</code>, the music is only paused;\r\n\t *        otherwise, native resources are freed and the music cannot be\r\n\t *        resumed.\r\n\t * @see playMusic\r\n\t */\r\n\tstopMusic(pause: boolean = false) {\r\n\t\tif (this._currentMusic) {\r\n\t\t\tthis._currentMusic.stop();\r\n\t\t\tif (!pause) {\r\n\t\t\t\tthis._currentMusic.disconnect();\r\n\t\t\t\tthis._musicFaderGain.disconnect();\r\n\t\t\t\tdelete this._currentMusic;\r\n\t\t\t\tdelete this._musicFaderGain;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Stops a playing sound, by ID.\r\n\t * @param {number} id The sound effect to stop.\r\n\t * @return {boolean} Whether the sound effect was stopped.  This will be\r\n\t *         <code>false</code> if the sound effect specified is no longer\r\n\t *         playing.\r\n\t * @see playSound\r\n\t */\r\n\tstopSound(id: number): boolean {\r\n\t\tconst sound: PlayingSound | null = this._removePlayingSound(id);\r\n\t\tif (sound) {\r\n\t\t\tsound.source.stop();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\ttoggleMuted(): boolean {\r\n\t\tthis._muted = !this._muted;\r\n\t\tif (this.context) {\r\n\t\t\tconst initialValue: number = this._muted ? 0 : 1;\r\n\t\t\tthis._volumeFaderGain.gain.setValueAtTime(initialValue, this.context.currentTime);\r\n\t\t\tthis._volumeFaderGain.gain.value = initialValue;\r\n\t\t}\r\n\t\treturn this._muted;\r\n\t}\r\n\r\n\tget fadeMusic(): boolean {\r\n\t\t'use strict';\r\n\t\treturn this._fadeMusic;\r\n\t}\r\n\r\n\tset fadeMusic(fade: boolean) {\r\n\t\tthis._fadeMusic = fade;\r\n\t}\r\n\r\n\tget musicFadeSeconds(): number {\r\n\t\treturn this._musicFade;\r\n\t}\r\n\r\n\tset musicFadeSeconds(seconds: number) {\r\n\t\tthis._musicFade = seconds;\r\n\t}\r\n}\r\n","export class TiledTileset {\r\n\r\n\tfirstgid: number;\r\n\timage: string;\r\n\timageWidth: number;\r\n\timageHeight: number;\r\n\tmargin: number;\r\n\tname: string;\r\n\tproperties: {};\r\n\tspacing: number;\r\n\ttileWidth: number;\r\n\ttileHeight: number;\r\n\r\n\tconstructor(data: any, imagePathModifier?: Function) {\r\n\t\tthis.firstgid = data.firstgid;\r\n\t\tthis.image = data.image;\r\n\t\tif (imagePathModifier) {\r\n\t\t\tthis.image = imagePathModifier(this.image);\r\n\t\t}\r\n\t\tthis.imageWidth = data.imagewidth;\r\n\t\tthis.imageHeight = data.imageheight;\r\n\t\tthis.margin = data.margin;\r\n\t\tthis.name = data.name;\r\n\t\tthis.properties = data.properties; // TODO\r\n\t\tthis.spacing = data.spacing;\r\n\t\tthis.tileWidth = data.tilewidth;\r\n\t\tthis.tileHeight = data.tileheight;\r\n\t}\r\n\r\n\tsetScale(scale: number) {\r\n\t\tthis.imageWidth *= scale;\r\n\t\tthis.imageHeight *= scale;\r\n\t\tthis.tileWidth *= scale;\r\n\t\tthis.tileHeight *= scale;\r\n\t\tthis.margin *= scale;\r\n\t\tthis.spacing *= scale;\r\n\t}\r\n}\r\n","import {Game} from '../gtp/Game';\r\nimport {Utils} from '../gtp/Utils';\r\nimport {Window} from '../gtp/GtpBase';\r\n\r\nexport class TiledObject {\r\n\r\n\tgid: number;\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tproperties: { };\r\n\r\n\tconstructor(data: any) {\r\n\t\tUtils.mixin(data, this);\r\n\t\tthis.properties = this.properties || {};\r\n\t\tthis.gid = this.gid || -1;\r\n\r\n\t\t// TODO: Remove\r\n\t\tconst gameWindow: Window = <any>window;\r\n\t\tconst game: Game = gameWindow.game;\r\n\t\tthis.x *= game._scale;\r\n\t\tthis.y  *= game._scale;\r\n\t\tthis.width *= game._scale;\r\n\t\tthis.height *= game._scale;\r\n\t}\r\n\r\n\tintersects(ox: number, oy: number, ow: number, oh: number) {\r\n\t\t'use strict';\r\n\t\t//console.log(this.name + \": \" + ox + ',' + oy + ',' + ow + ',' + oh +\r\n\t\t//      ' -> ' + this.x + ',' + this.y + ',' + this.width + ',' + this.height);\r\n\t\tlet tw: number = this.width;\r\n\t\tlet th: number = this.height;\r\n\t\tlet rw: number = ow;\r\n\t\tlet rh: number = oh;\r\n\t\tif (rw <= 0 || rh <= 0 || tw <= 0 || th <= 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst tx: number = this.x;\r\n\t\tconst ty: number = this.y;\r\n\t\tconst rx: number = ox;\r\n\t\tconst ry: number = oy;\r\n\t\trw += rx;\r\n\t\trh += ry;\r\n\t\ttw += tx;\r\n\t\tth += ty;\r\n\t\t//      overflow || intersect\r\n\t\treturn ((rw < rx || rw > tx) &&\r\n\t\t\t(rh < ry || rh > ty) &&\r\n\t\t\t(tw < tx || tw > rx) &&\r\n\t\t\t(th < ty || th > ry));\r\n\t}\r\n}\r\n","import {TiledObject} from './TiledObject';\r\n\r\nexport class TiledLayer {\r\n\r\n\tmap: any;\r\n\tname: string;\r\n\twidth: number;\r\n\theight: number;\r\n\tdata: number[];\r\n\topacity: number;\r\n\tvisible: boolean;\r\n\ttype: string;\r\n\tx: number;\r\n\ty: number;\r\n\tobjects: TiledObject[];\r\n\tobjectsByName: { [name: string]: TiledObject };\r\n\r\n\tconstructor(map: any, data: any) {\r\n\t\tthis.map = map;\r\n\t\tthis.name = data.name;\r\n\t\tthis.width = data.width;\r\n\t\tthis.height = data.height;\r\n\t\tthis.data = data.data;\r\n\t\tthis.opacity = data.opacity;\r\n\t\tthis.visible = data.visible;\r\n\t\tthis.type = data.type;\r\n\t\tthis.x = data.x;\r\n\t\tthis.y = data.y;\r\n\t\tthis._setObjects(data.objects);\r\n\t}\r\n\r\n\tgetData(row: number, col: number): number {\r\n\t\tif (!this.data) { // An object layer\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tconst index: number = this._getIndex(row, col);\r\n\t\treturn this.data[index];\r\n\t}\r\n\r\n\tsetData(row: number, col: number, value: number): boolean {\r\n\t\tif (!this.data) { // An object layer\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst index: number = this._getIndex(row, col);\r\n\t\tthis.data[index] = value;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate _getIndex(row: number, col: number): number {\r\n\t\treturn row * this.map.colCount + col;\r\n\t}\r\n\r\n\tgetObjectByName(name: string): TiledObject | null {\r\n\t\treturn this.objectsByName ? this.objectsByName[name] : null;\r\n\t}\r\n\r\n\tgetObjectIntersecting(x: number, y: number, w: number, h: number): TiledObject | null {\r\n\t\tif (this.objects) {\r\n\t\t\tfor (let i: number = 0; i < this.objects.length; i++) {\r\n\t\t\t\tconst obj: TiledObject = this.objects[i];\r\n\t\t\t\tif (obj.intersects(x, y, w, h)) {\r\n\t\t\t\t\treturn obj;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tisObjectGroup(): boolean {\r\n\t\treturn this.type === 'objectgroup';\r\n\t}\r\n\r\n\tprivate _setObjects(objects: any) {\r\n\t\t'use strict';\r\n\t\tif (objects) {\r\n\t\t\tthis.objects = [];\r\n\t\t\tthis.objectsByName = {};\r\n\t\t\tfor (let i: number = 0; i < objects.length; i++) {\r\n\t\t\t\tconst obj: TiledObject = new TiledObject(objects[i]);\r\n\t\t\t\tthis.objects.push(obj);\r\n\t\t\t\tthis.objectsByName[objects[i].name] = obj;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import {TiledTileset} from './TiledTileset';\r\nimport {TiledLayer} from './TiledLayer';\r\nimport {Image} from '../gtp/Image';\r\nimport {Game} from '../gtp/Game';\r\nimport {Window} from '../gtp/GtpBase';\r\n\r\nexport class TiledMap {\r\n\r\n\trowCount: number;\r\n\tcolCount: number;\r\n\ttileWidth: number;\r\n\ttileHeight: number;\r\n\tscreenWidth: number;\r\n\tscreenHeight: number;\r\n\tscreenRows: number;\r\n\tscreenCols: number;\r\n\timagePathModifier: Function;\r\n\tlayers: TiledLayer[];\r\n\tlayersByName: { [name: string]: TiledLayer };\r\n\tobjectGroups: TiledLayer[];\r\n\ttilesets: TiledTileset[];\r\n\tproperties: any;\r\n\tversion: number;\r\n\torientation: string;\r\n\r\n\t/**\r\n\t * A 2d game map, generated in Tiled.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\tconstructor(data: any, args: any) {\r\n\r\n\t\tthis.rowCount = data.height;\r\n\t\tthis.colCount = data.width;\r\n\t\tthis.tileWidth = args.tileWidth;\r\n\t\tthis.tileHeight = args.tileHeight;\r\n\t\tthis.screenWidth = args.screenWidth;\r\n\t\tthis.screenHeight = args.screenHeight;\r\n\t\tthis.screenRows = Math.ceil(this.screenHeight / this.tileHeight);\r\n\t\tthis.screenCols = Math.ceil(this.screenWidth / this.tileWidth);\r\n\t\tlet imagePathModifier: Function = args ? args.imagePathModifier : null;\r\n\r\n\t\tthis.layers = [];\r\n\t\tthis.layersByName = {};\r\n\t\tthis.objectGroups = [];\r\n\t\tfor (let i: number = 0; i < data.layers.length; i++) {\r\n\t\t\tthis.addLayer(data.layers[i]);\r\n\t\t}\r\n\r\n\t\tthis.tilesets = [];\r\n\t\tif (data.tilesets && data.tilesets.length) {\r\n\t\t\tfor (let i: number = 0; i < data.tilesets.length; i++) {\r\n\t\t\t\tthis.tilesets.push(new TiledTileset(data.tilesets[i], imagePathModifier));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.properties = data.properties;\r\n\t\tthis.version = data.version;\r\n\t\tthis.orientation = data.orientation;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a layer to this map.  This method is called internally by the library\r\n\t * and the programmer typically does not need to call it.\r\n\t *\r\n\t * @param {object} layerData The raw layer data.\r\n\t * @method\r\n\t */\r\n\taddLayer(layerData: any) {\r\n\t\tconst layer: TiledLayer = new TiledLayer(this, layerData);\r\n\t\tthis.layers.push(layer);\r\n\t\tthis.layersByName[layer.name] = layer;\r\n\t\tif (layer.isObjectGroup()) {\r\n\t\t\tthis.objectGroups.push(layer);\r\n\t\t}\r\n\t}\r\n\r\n\tdraw(ctx: CanvasRenderingContext2D, centerRow: number, centerCol: number,\r\n\t\t\tdx: number = 0, dy: number = 0) {\r\n\r\n\t\tconst colCount: number = this.colCount;\r\n\t\tconst rowCount: number = this.rowCount;\r\n\r\n\t\tconst screenCols: number = this.screenRows;\r\n\t\tconst screenRows: number = this.screenCols;\r\n\t\tconst tileW: number = this.tileWidth;\r\n\t\tconst tileH: number = this.tileHeight;\r\n\t\tconst tileSize: number = tileW; // Assumes square tiles (!).  Fix me one day\r\n\t\tconst screenWidth: number = this.screenWidth;\r\n\t\tconst screenHeight: number = this.screenHeight;\r\n\r\n\t\tlet col0: number = centerCol - Math.floor(screenCols / 2);\r\n\t\tif (col0 < 0) {\r\n\t\t\tcol0 += colCount;\r\n\t\t}\r\n\t\tlet row0: number = centerRow - Math.floor(screenRows / 2);\r\n\t\tif (row0 < 0) {\r\n\t\t\trow0 += rowCount;\r\n\t\t}\r\n\r\n\t\t// Center point of screen, in map x,y coordinates.\r\n\t\tconst cx: number = centerCol * tileW + dx + tileW / 2;\r\n\t\tconst cy: number = centerRow * tileH + dy + tileH / 2;\r\n\r\n\t\t// Top-left of screen, in map x,y coordinates.\r\n\t\tconst x0: number = cx - screenWidth / 2;\r\n\t\tconst y0: number = cy - screenHeight / 2;\r\n\r\n\t\tlet topLeftCol: number = Math.floor(x0 / tileW);\r\n\t\tif ((x0 % tileSize) < 0) {\r\n\t\t\ttopLeftCol--;\r\n\t\t}\r\n\t\tconst tileEdgeX: number = topLeftCol * tileW;\r\n\r\n\t\tlet topLeftRow: number = Math.floor(y0 / tileH);\r\n\t\tif ((y0 % tileSize) < 0) { // e.g. is < 0 and not a multiple of tileSize\r\n\t\t\ttopLeftRow--;\r\n\t\t}\r\n\t\tconst tileEdgeY: number = topLeftRow * tileH; // getTileEdge(topLeftY);\r\n\r\n\t\t// The view coordinates at which to start painting.\r\n\t\tconst startX: number = tileEdgeX - x0;\r\n\t\tlet _x: number = startX;\r\n\t\tconst startY: number = tileEdgeY - y0;\r\n\t\tlet _y: number = startY;\r\n\r\n\t\tif (topLeftCol < 0) {\r\n\t\t\ttopLeftCol += colCount;\r\n\t\t}\r\n\t\tif (topLeftRow < 0) {\r\n\t\t\ttopLeftRow += rowCount;\r\n\t\t}\r\n\r\n\t\t// Paint until the end of the screen\r\n\t\tlet row: number = topLeftRow;\r\n\t\tconst layerCount: number = this.getLayerCount();\r\n\t\tlet tileCount: number = 0;\r\n\t\twhile (_y < screenHeight) {\r\n\t\t\tfor (let l: number = 0; l < layerCount; l++) {\r\n\r\n\t\t\t\tlet col: number = topLeftCol;\r\n\t\t\t\t_x = startX;\r\n\r\n\t\t\t\tconst layer: TiledLayer = this.getLayerByIndex(l);\r\n\t\t\t\tif (layer.visible) {\r\n\r\n\t\t\t\t\tlet prevOpacity: number = 1; // Default value needed for strict null checks\r\n\t\t\t\t\tif (layer.opacity < 1) {\r\n\t\t\t\t\t\tprevOpacity = ctx.globalAlpha;\r\n\t\t\t\t\t\tctx.globalAlpha = prevOpacity * layer.opacity;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twhile (_x < screenWidth) {\r\n\t\t\t\t\t\tconst value: number = layer.getData(row % rowCount, col % colCount);\r\n\t\t\t\t\t\tthis.drawTile(ctx, _x, _y, value, layer);\r\n\t\t\t\t\t\ttileCount++;\r\n\t\t\t\t\t\t_x += tileW;\r\n\t\t\t\t\t\tcol++;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (layer.opacity < 1) {\r\n\t\t\t\t\t\tctx.globalAlpha = prevOpacity;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Here we could render sprites in-between layers\r\n\t\t\t}\r\n\r\n\t\t\t_y += tileH;\r\n\t\t\trow++;\r\n\t\t}\r\n\r\n\t\t//console.log('tileCount === ' + tileCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a layer by name.\r\n\t *\r\n\t * @param {string} name The name of the layer.\r\n\t * @return {TiledLayer} The layer, or null if there is no layer with\r\n\t *         that name.\r\n\t * @method\r\n\t */\r\n\tgetLayer(name: string): TiledLayer {\r\n\t\treturn this.layersByName[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a layer by index.\r\n\t *\r\n\t * @param {int} index The index of the layer.\r\n\t * @return {TiledLayer} The layer, or null if there is no layer at\r\n\t *         that index.\r\n\t * @method\r\n\t */\r\n\tgetLayerByIndex(index: number): TiledLayer {\r\n\t\treturn this.layers[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the number of layers in this map.\r\n\t *\r\n\t * @return {int} The number of layers in this map.\r\n\t */\r\n\tgetLayerCount(): number {\r\n\t\treturn this.layers.length;\r\n\t}\r\n\r\n\tprivate _getImageForGid(gid: number): TiledTileset {\r\n\t\tconst tilesetCount: number = this.tilesets.length;\r\n\t\tfor (let i: number = 0; i < tilesetCount; i++) {\r\n\t\t\tif (this.tilesets[i].firstgid > gid) {\r\n\t\t\t\treturn this.tilesets[i - 1];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.tilesets[tilesetCount - 1];\r\n\t}\r\n\r\n\tdrawTile(ctx: CanvasRenderingContext2D, x: number, y: number,\r\n\t\t\tvalue: number, layer: TiledLayer) {\r\n\r\n\t\tif (value <= 0) { // 0 => no tile to draw\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst tileset: TiledTileset = this._getImageForGid(value);\r\n\t\tif (!tileset) {\r\n\t\t\tconsole.log('null tileset for: ' + value + ' (layer ' + layer.name + ')');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvalue -= tileset.firstgid;\r\n\t\tif (value < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst gameWindow: Window = <any>window;\r\n\t\tconst game: Game = gameWindow.game;\r\n\t\tconst img: Image = game.assets.getTmxTilesetImage(tileset);\r\n\r\n\t\tconst tileW: number = this.tileWidth;\r\n\t\tconst sw: number = tileW + tileset.spacing;\r\n\t\tconst tileH: number = this.tileHeight;\r\n\t\tconst sh: number = tileH + tileset.spacing;\r\n\r\n\t\t// TODO: \"+ 1\" is based on extra space at end of image.  Should be configured/calculated\r\n\t\tlet imgColCount: number = Math.floor(img.width / sw);\r\n\t\tif (tileset.spacing > 0 && ((img.width % sw) === tileW)) {\r\n\t\t\timgColCount++;\r\n\t\t}\r\n\t\tconst imgY: number = Math.floor(value / imgColCount) * sh;\r\n\t\tconst imgX: number = (value % imgColCount) * sw;\r\n\r\n\t\t//ctx.drawImage(img, imgX,imgY,tileW,tileH, x,y,tileW,tileH);\r\n\t\timg.drawScaled2(ctx, imgX, imgY, tileW, tileH, x, y, tileW, tileH);\r\n\r\n\t}\r\n\r\n\tsetScale(scale: number) {\r\n\t\tthis.tileWidth *= scale;\r\n\t\tthis.tileHeight *= scale;\r\n\t\tthis.screenRows = Math.ceil(this.screenHeight / this.tileHeight);\r\n\t\tthis.screenCols = Math.ceil(this.screenWidth / this.tileWidth);\r\n\t\tconst tilesetCount: number = this.tilesets.length;\r\n\t\tfor (let i: number = 0; i < tilesetCount; i++) {\r\n\t\t\treturn this.tilesets[i].setScale(scale);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the pixel width of this map.\r\n\t *\r\n\t * @return {int} The pixel width of this map.\r\n\t * @method\r\n\t */\r\n\tgetPixelWidth(): number {\r\n\t\treturn this.colCount * this.tileWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the pixel height of this map.\r\n\t *\r\n\t * @return {int} The pixel height of this map.\r\n\t * @method\r\n\t */\r\n\tgetPixelHeight(): number {\r\n\t\treturn this.rowCount * this.tileHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a layer from this map.\r\n\t * @param {string} layerName The name of the layer to remove.\r\n\t * @return {boolean} Whether a layer by that name was found.\r\n\t * @method\r\n\t */\r\n\tremoveLayer(layerName: string): boolean {\r\n\t\tfor (let i: number = 0; i < this.layers.length; i++) {\r\n\t\t\tif (this.layers[i].name === layerName) {\r\n\t\t\t\tthis.layers.splice(i, 1);\r\n\t\t\t\tdelete this.layersByName[layerName];\r\n\t\t\t\tfor (let j: number = 0; j < this.objectGroups.length; j++) {\r\n\t\t\t\t\tif (this.objectGroups[j].name === layerName) {\r\n\t\t\t\t\t\tdelete this.objectGroups[j];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import {SpriteSheet} from './SpriteSheet';\r\nimport {AssetType} from './AssetType';\r\nimport {AudioSystem} from './AudioSystem';\r\nimport {Utils} from './Utils';\r\nimport {ImageUtils} from './ImageUtils';\r\nimport {Image} from './Image';\r\nimport {Sound} from './Sound';\r\nimport {TiledTileset} from '../tiled/TiledTileset';\r\nimport {TiledMap} from '../tiled/TiledMap';\r\n\r\ninterface ResourceType {\r\n\ttype: AssetType;\r\n}\r\n\r\n/**\r\n * Loads resources for a game.  All games have to load resources such as\r\n * images, sound effects, JSON data, sprite sheets, etc.  This class provides\r\n * a wrapper around the loading of such resources, as well as a callback\r\n * mechanism to know when loading completes.  Games can use this class in a\r\n * \"loading\" state, for example.<p>\r\n *\r\n * Currently supported resources include:\r\n * <ul>\r\n *   <li>Images\r\n *   <li>Sound effects\r\n *   <li>JSON data\r\n *   <li>Sprite sheets\r\n *   <li>TMX maps\r\n * </ul>\r\n */\r\nexport class AssetLoader {\r\n\r\n\tprivate _scale: number;\r\n\tprivate loadingAssetData: { [id: string]: ResourceType };\r\n\tprivate responses: { [id: string]: any };\r\n\tprivate callback: any;\r\n\taudio: AudioSystem;\r\n\tprivate _assetRoot: string | undefined;\r\n\tprivate nextCallback: Function;\r\n\r\n\t/**\r\n\t * Provides methods to load images, sounds, and Tiled maps.\r\n\t *\r\n\t * @param {number} scale How much to scale image resources.\r\n\t * @param {AudioSystem} audio A web audio context.\r\n\t * @param {string} [assetRoot] If specified, this is the implicit root\r\n\t *        directory for all assets to load.  Use this if all assets are\r\n\t *        in a subfolder or different hierarchy than the project itself.\r\n\t * @constructor\r\n\t */\r\n\tconstructor(scale: number = 1, audio: AudioSystem, assetRoot?: string) {\r\n\t\tthis._scale = scale || 1;\r\n\t\tthis.loadingAssetData = {};\r\n\t\tthis.responses = {};\r\n\t\tthis.callback = null;\r\n\t\tthis.audio = audio;\r\n\t\tthis._assetRoot = assetRoot;\r\n\t}\r\n\r\n\t/**\r\n\t * Starts loading a JSON resource.\r\n\t * @param {string} id The ID to use when retrieving this resource.\r\n\t * @param {string} [url=id] The URL of the resource, defaulting to\r\n\t *        {@code id} if not specified.\r\n\t */\r\n\taddJson(id: string, url: string = id) {\r\n\r\n\t\tif (this._assetRoot) {\r\n\t\t\turl = this._assetRoot + url;\r\n\t\t}\r\n\r\n\t\tif (this._isAlreadyTracked(id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.loadingAssetData[id] = { type: AssetType.JSON };\r\n\t\tconsole.log('Adding: ' + id + ' => ' + url +\r\n\t\t\t', remaining == ' + Utils.getObjectSize(this.loadingAssetData) +\r\n\t\t\t', callback == ' + (this.callback !== null));\r\n\r\n\t\tconst xhr: XMLHttpRequest = new XMLHttpRequest();\r\n\t\txhr.onreadystatechange = () => {\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\tconst response: string = xhr.responseText;\r\n\t\t\t\tthis._completed(id, response);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\txhr.open('GET', url, true);\r\n\t\txhr.send(null);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Starts loading a canvas resource.\r\n\t * @param {string} id The ID to use when retrieving this resource.\r\n\t * @param {string} imageSrc The URL of the resource.\r\n\t */\r\n\taddCanvas(id: string, imageSrc: string) {\r\n\r\n\t\tif (this._assetRoot) {\r\n\t\t\timageSrc = this._assetRoot + imageSrc;\r\n\t\t}\r\n\r\n\t\tconst self: AssetLoader = this;\r\n\r\n\t\tconst  image: HTMLImageElement = document.createElement('img'); //new Image();\r\n\t\tif (this._isAlreadyTracked(id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.loadingAssetData[id] = { type: AssetType.IMAGE };\r\n\t\tconsole.log('Adding: ' + id + ' => ' + imageSrc +\r\n\t\t\t', remaining == ' + Utils.getObjectSize(this.loadingAssetData) +\r\n\t\t\t', callback == ' + (this.callback !== null));\r\n\t\timage.addEventListener('load', () => {\r\n\t\t\tconst canvas: HTMLCanvasElement = ImageUtils.resize(image, self._scale);\r\n\t\t\tself._completed(id, canvas);\r\n\t\t});\r\n\r\n\t\timage.src = imageSrc;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Starts loading an image resource.\r\n\t * @param {string} id The ID to use when retrieving this resource.\r\n\t * @param {string} imageSrc The URL of the resource.\r\n\t * @param {boolean} firstPixelTranslucent If truthy, the pixel at (0, 0)\r\n\t *        is made translucent, along with all other pixels of the same\r\n\t *        color.  The default value is <code>false</code>.\r\n\t */\r\n\taddImage(id: string, imageSrc: string,\r\n\t\t\tfirstPixelTranslucent: boolean = false) {\r\n\r\n\t\tif (this._assetRoot) {\r\n\t\t\timageSrc = this._assetRoot + imageSrc;\r\n\t\t}\r\n\r\n\t\tconst self: AssetLoader = this;\r\n\r\n\t\tconst image: HTMLImageElement = document.createElement('img'); //new Image();\r\n\t\tif (this._isAlreadyTracked(id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.loadingAssetData[id] = { type: AssetType.IMAGE };\r\n\t\tconsole.log('Adding: ' + id + ' => ' + imageSrc +\r\n\t\t\t', remaining == ' + Utils.getObjectSize(this.loadingAssetData) +\r\n\t\t\t', callback == ' + (this.callback !== null));\r\n\t\timage.addEventListener('load', () => {\r\n\t\t\tconst canvas: HTMLCanvasElement = ImageUtils.resize(image, self._scale);\r\n\t\t\tconst gtpImage: Image = new Image(canvas);\r\n\t\t\tif (firstPixelTranslucent) {\r\n\t\t\t\tgtpImage.makeColorTranslucent(0, 0);\r\n\t\t\t}\r\n\t\t\tself._completed(id, gtpImage);\r\n\t\t});\r\n\r\n\t\timage.src = imageSrc;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Starts loading a sound resource.\r\n\t * @param {string} id The ID to use when retrieving this resource.\r\n\t * @param {string} soundSrc The URL of the resource.\r\n\t * @param {number} [loopStart=0] Where to start, in seconds, if/when this\r\n\t *        sound loops (which is typical when using a sound as music).\r\n\t * @param {boolean} [loopByDefaultIfMusic=true] Whether this sound should\r\n\t *        loop by default when it is played as music.\r\n\t */\r\n\taddSound(id: string, soundSrc: string, loopStart: number = 0,\r\n\t\t\tloopByDefaultIfMusic: boolean = true) {\r\n\r\n\t\tif (this.audio.isInitialized()) {\r\n\r\n\t\t\tif (this._isAlreadyTracked(id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.loadingAssetData[id] = { type: AssetType.AUDIO };\r\n\r\n\t\t\tif (this._assetRoot) {\r\n\t\t\t\tsoundSrc = this._assetRoot + soundSrc;\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr: XMLHttpRequest = new XMLHttpRequest();\r\n\t\t\txhr.onload = () => {\r\n\t\t\t\t// TODO: Clean up this API\r\n\t\t\t\tthis.audio.context.decodeAudioData(xhr.response, (buffer: AudioBuffer) => {\r\n\t\t\t\t\tconst sound: Sound = new Sound(id, buffer, loopStart || 0);\r\n\t\t\t\t\tif (typeof loopByDefaultIfMusic !== 'undefined') {\r\n\t\t\t\t\t\tsound.setLoopsByDefaultIfMusic(loopByDefaultIfMusic);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.audio.addSound(sound);\r\n\t\t\t\t\tthis._completed(id, buffer);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\txhr.open('GET', soundSrc, true);\r\n\t\t\txhr.responseType = 'arraybuffer';\r\n\t\t\txhr.send(null);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Starts loading a sprite sheet resource.\r\n\t * @param {string} id The ID to use when retrieving this resource.\r\n\t * @param {string} imageSrc The URL of the resource.\r\n\t * @param {int} cellW The width of a cell.\r\n\t * @param {int} cellH The height of a cell.\r\n\t * @param {int} spacingX The horizontal spacing between cells.  Assumed to\r\n\t *        be 0 if not defined.\r\n\t * @param {int} spacingY The vertical spacing between cells.  Assumed to\r\n\t *        be 0 if not defined.\r\n\t * @param {boolean} firstPixelTranslucent If truthy, the pixel at (0, 0)\r\n\t *        is made translucent, along with all other pixels of the same color.\r\n\t */\r\n\taddSpriteSheet(id: string, imageSrc: string, cellW: number, cellH: number,\r\n\t\t\tspacingX: number = 0, spacingY: number = 0,\r\n\t\t\tfirstPixelTranslucent: boolean = false) {\r\n\r\n\t\tconst self: AssetLoader = this;\r\n\t\tspacingX = spacingX || 0;\r\n\t\tspacingY = spacingY || 0;\r\n\t\tcellW *= self._scale;\r\n\t\tcellH *= self._scale;\r\n\t\tspacingX *= self._scale;\r\n\t\tspacingY *= self._scale;\r\n\r\n\t\tif (this._assetRoot) {\r\n\t\t\timageSrc = this._assetRoot + imageSrc;\r\n\t\t}\r\n\r\n\t\tconst image: HTMLImageElement = document.createElement('img'); //new Image();\r\n\t\tif (this._isAlreadyTracked(id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.loadingAssetData[id] = { type: AssetType.IMAGE };\r\n\t\tconsole.log('Adding: ' + id + ' => ' + imageSrc +\r\n\t\t\t', remaining == ' + Utils.getObjectSize(this.loadingAssetData) +\r\n\t\t\t', callback == ' + (this.callback !== null));\r\n\t\timage.addEventListener('load', () => {\r\n\t\t\tconst canvas: HTMLCanvasElement = ImageUtils.resize(image, self._scale);\r\n\t\t\tconst gtpImage: Image = new Image(canvas);\r\n\t\t\tif (firstPixelTranslucent) {\r\n\t\t\t\tgtpImage.makeColorTranslucent(0, 0);\r\n\t\t\t}\r\n\t\t\tconst ss: SpriteSheet = new SpriteSheet(gtpImage, cellW, cellH, spacingX, spacingY);\r\n\t\t\tself._completed(id, ss);\r\n\t\t});\r\n\r\n\t\timage.src = imageSrc;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Registers all images needed by the TMX map's tilesets to this asset\r\n\t * loader.\r\n\t *\r\n\t * @param {TiledMap} map The Tiled map.\r\n\t */\r\n\taddTmxMap(map: TiledMap) {\r\n\t\tif (map.tilesets && map.tilesets.length) {\r\n\t\t\tfor (let i: number = 0; i < map.tilesets.length; i++) {\r\n\t\t\t\tconst tileset: TiledTileset = map.tilesets[i];\r\n\t\t\t\tconst id: string = '_tilesetImage_' + tileset.name;\r\n\t\t\t\tthis.addImage(id, tileset.image);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the image corresponding to a Tiled tileset.  This method is\r\n\t * called by the library and is typically not called directly by the\r\n\t * application.\r\n\t *\r\n\t * @param {TiledTileset} tileset The tile set.\r\n\t * @return {Image} The tileset image.\r\n\t */\r\n\tgetTmxTilesetImage(tileset: TiledTileset): Image {\r\n\t\treturn this.responses['_tilesetImage_' + tileset.name];\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves a resource by ID.\r\n\t * @param {string} res The ID of the resource.\r\n\t * @return The resource, or null if not found.\r\n\t */\r\n\tget(res: string): any {\r\n\t\treturn this.responses[res];\r\n\t}\r\n\r\n\t_isAlreadyTracked(id: string): boolean {\r\n\t\tif (this.loadingAssetData[id]) {\r\n\t\t\tconsole.log('A resource with id ' + id + ' is already loading.  Assuming they are the same');\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (this.responses[id]) {\r\n\t\t\tconsole.log('A resource with id ' + id + ' has already been loaded.');\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a resource.\r\n\t * @param {string} res The ID for the resource.\r\n\t * @param {any} value The resource value.\r\n\t */\r\n\tset(res: string, value: any) {\r\n\t\tthis.responses[res] = value;\r\n\t}\r\n\r\n\t_completed(res: string, response: any) {\r\n\t\tif (!this.loadingAssetData[res]) {\r\n\t\t\tconsole.error('Resource not found! - ' + res);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.loadingAssetData[res].type === AssetType.JSON) {\r\n\t\t\tresponse = JSON.parse(response);\r\n\t\t}\r\n\t\tthis.responses[res] = response;\r\n\t\tdelete this.loadingAssetData[res];\r\n\t\tconsole.log('Completed: ' + res + ', remaining == ' +\r\n\t\t\t\tUtils.getObjectSize(this.loadingAssetData) +\r\n\t\t\t\t', callback == ' + (this.callback !== null));\r\n\t\tif (this.isDoneLoading() && this.callback) {\r\n\t\t\tthis.callback.call();\r\n\t\t\tdelete this.callback;\r\n\t\t\tconsole.log('... Callback called and deleted (callback == ' + (this.callback !== null) + ')');\r\n\t\t\tif (this.nextCallback) {\r\n\t\t\t\tthis.callback = this.nextCallback;\r\n\t\t\t\tdelete this.nextCallback;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log('... Not running callback - ' + this.isDoneLoading() + ', ' + (this.callback !== null));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether all assets in this loader have successfully loaded.\r\n\t *\r\n\t * @return {boolean} Whether all assets have loaded.\r\n\t */\r\n\tisDoneLoading(): boolean {\r\n\t\treturn Utils.getObjectSize(this.loadingAssetData) === 0;\r\n\t}\r\n\r\n\tonLoad(callback: Function) {\r\n\r\n\t\tif (this.isDoneLoading()) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t\telse if (this.callback) { // A new callback added from another callback\r\n\t\t\tthis.nextCallback = callback;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.callback = callback;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import {AssetLoader} from './AssetLoader';\nimport {AudioSystem} from './AudioSystem';\n\ndescribe('AssetLoader', () => {\n\t'use strict';\n\n\tbeforeEach(() => {\n\t\tjasmine.Ajax.install();\n\t});\n\n\tafterEach(() => {\n\t\tjasmine.Ajax.uninstall();\n\t});\n\n\tit('constructor, happy path', () => {\n\t\tnew AssetLoader(1, new AudioSystem()); // tslint:disable-line\n\t});\n\n\tit('isDoneLoading() works', () => {\n\n\t\t// Initially nothing queued up, so we're \"done loading\"\n\t\tconst assetLoader: AssetLoader = new AssetLoader(1, new AudioSystem());\n\t\texpect(assetLoader.isDoneLoading()).toBeTruthy();\n\n\t\t// Add something to load, now we're waiting\n\t\tassetLoader.addJson('testJson', '/fake/url.json');\n\t\texpect(jasmine.Ajax.requests.mostRecent().url).toBe('/fake/url.json');\n\t\texpect(assetLoader.isDoneLoading()).toBeFalsy();\n\n\t\t// Mock a response, which triggers AssetLoader to receive the response as well\n\t\tjasmine.Ajax.requests.mostRecent().respondWith({\n\t\t\tstatus: 200,\n\t\t\tcontentType: 'application/json',\n\t\t\tresponseText: '{ \"data\": 1 }'\n\t\t});\n\n\t\t// Now that we've received the response, check that we're \"done loading\" again\n\t\texpect(assetLoader.isDoneLoading()).toBeTruthy();\n\t});\n});\n","import {Image} from './Image';\r\nimport {SpriteSheet} from './SpriteSheet';\r\nimport {Window} from './GtpBase';\r\n\r\nexport class BitmapFont extends SpriteSheet {\r\n\r\n\tconstructor(gtpImage: Image, cellW: number, cellH: number, spacing: number, spacingY: number) {\r\n\t\tsuper(gtpImage, cellW, cellH, spacing, spacingY);\r\n\t}\r\n\r\n\tdrawString(str: string, x: number, y: number) {\r\n\r\n\t\tconst glyphCount: number = this.size;\r\n\t\tconst gameWindow: Window = <any>window;\r\n\t\tconst ctx: CanvasRenderingContext2D = gameWindow.game.canvas.getContext('2d')!;\r\n\t\tconst charWidth: number = this.cellW;\r\n\r\n\t\tfor (let i: number = 0; i < str.length; i++) {\r\n\t\t\tlet ch: number = str.charCodeAt(i) - 0x20;\r\n\t\t\tif (ch < 0 || ch >= glyphCount) {\r\n\t\t\t\tch = 0;\r\n\t\t\t}\r\n\t\t\tthis.drawByIndex(ctx, x, y, ch);\r\n\t\t\tx += charWidth;\r\n\t\t}\r\n\r\n\t}\r\n}\r\n","/**\r\n * Arguments to the Delay constructor.\r\n */\r\nexport interface DelayArgs {\r\n\tmillis: any;\r\n\tminDelta?: number;\r\n\tmaxDelta?: number;\r\n\tcallback?: Function;\r\n\tloop?: boolean;\r\n\tloopCount?: number;\r\n}\r\n\r\n/**\r\n * A way to keep track of a delay.  Useful when you want some event to occur\r\n * every X milliseconds, for example.\r\n *\r\n * @param {object} args Arguments to this delay.\r\n * @param {number-or-array} args.millis The number of milliseconds between\r\n *        events.  You can specify an array of numbers to have the even trigger\r\n *        at non-equal intervals.\r\n * @param {int} [args.minDelta] If specified, a minimum amount of variance for\r\n *        the event.  May be negative, but should be larger than the smallest\r\n *        value specified in millis.\r\n * @param {int} [args.maxDelta] If specified, a maximum amount of variance for\r\n *        the event.\r\n * @param {int} [args.loop] If specified and <code>true</code>, this timer will\r\n *        automatically repeat and <code>isDone()</code> will never return\r\n *        <code>true</code>.\r\n * @param {int} [args.loopCount] This argument is only honored if\r\n *        <code>args.loop</code> is defined and <code>true</code>.  If true,\r\n *        this argument is the number of times to loop; if this argument is not\r\n *        specified, looping will occur indefinitely.\r\n * @param {function} [args.callback] If specified, a callback function that\r\n *        will be called when this delay fires.\r\n * @constructor\r\n */\r\nexport class Delay {\r\n\r\n\t_initial: number[];\r\n\t_initialIndex: number;\r\n\t_callback: Function | undefined;\r\n\t_loop: boolean;\r\n\t_loopCount: number;\r\n\t_maxLoopCount: number;\r\n\t_minDelta: number;\r\n\t_maxDelta: number;\r\n\t_remaining: number;\r\n\t_curInitial: number;\r\n\r\n\tconstructor(args: DelayArgs) {\r\n\t\tif (!args || !args.millis) {\r\n\t\t\tthrow 'Missing required \"millis\" argument to Delay';\r\n\t\t}\r\n\t\tthis._initial = args.millis.length ? args.millis : [args.millis];\r\n\t\tthis._initialIndex = 0;\r\n\t\tif (args.minDelta && args.maxDelta) {\r\n\t\t\tthis.setRandomDelta(args.minDelta, args.maxDelta);\r\n\t\t}\r\n\t\tthis._callback = args.callback;\r\n\t\tthis._loop = !!args.loop;\r\n\t\tthis._loopCount = 0;\r\n\t\tthis._maxLoopCount = this._loop ? (args.loopCount || -1) : -1;\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\t/**\r\n\t * Should be called in the update() method of the current game state to\r\n\t * update this Delay.\r\n\t *\r\n\t * @param {int} delta The time that has elapsed since the last call to this\r\n\t *        method.\r\n\t */\r\n\tupdate(delta: number) {\r\n\t\tif (this._remaining > 0) {\r\n\t\t\tthis._remaining -= delta;\r\n\t\t\tif (this._remaining <= 0 && this._callback) {\r\n\t\t\t\tthis._callback(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._remaining <= 0) {\r\n\t\t\tif (this._loop) {\r\n\t\t\t\tif (this._maxLoopCount === -1 || this._loopCount < this._maxLoopCount - 1) {\r\n\t\t\t\t\tthis._loopCount++;\r\n\t\t\t\t\tthis.reset(true);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._loopCount = this._maxLoopCount;\r\n\t\t\t\t\tthis._remaining = -1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._remaining = Math.max(0, this._remaining);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.isDone();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the number of times this Delay has looped.\r\n\t *\r\n\t * @return {int} The number of times this Delay has looped.\r\n\t */\r\n\tgetLoopCount(): number {\r\n\t\treturn this._loopCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the maximum delta value, or -1 if none was defined.\r\n\t *\r\n\t * @return {int} The maximum delta value.\r\n\t * @see getMinDelta()\r\n\t */\r\n\tgetMaxDelta(): number {\r\n\t\treturn typeof this._maxDelta !== 'undefined' ? this._maxDelta : -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the minimum delta value, or -1 if none was defined.\r\n\t *\r\n\t * @return {int} The minimum delta value.\r\n\t * @see getMaxDelta()\r\n\t */\r\n\tgetMinDelta(): number {\r\n\t\treturn typeof this._minDelta !== 'undefined' ? this._minDelta : -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the remaining time on this delay.\r\n\t *\r\n\t * @return {int} The remaining time on this delay.\r\n\t */\r\n\tgetRemaining(): number {\r\n\t\treturn this._remaining;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns how far along we are in this delay, in the range\r\n\t * 0 - 1.\r\n\t *\r\n\t * @return {int} How far along we are in this delay.\r\n\t */\r\n\tgetRemainingPercent(): number {\r\n\t\treturn this._remaining / this._curInitial;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this Delay has completed.\r\n\t *\r\n\t * @return {boolean} Whether this Delay has completed.\r\n\t */\r\n\tisDone(): boolean {\r\n\t\treturn (!this._loop || this._loopCount === this._maxLoopCount) &&\r\n\t\t\tthis._remaining <= 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Causes this delay to trigger with a little random variance.\r\n\t *\r\n\t * @param {int} min The minimum possible variance, inclusive.\r\n\t * @param {int} max The maximum possible variance, exclusive.\r\n\t */\r\n\tsetRandomDelta(min: number, max: number) {\r\n\t\tthis._minDelta = min;\r\n\t\tthis._maxDelta = max;\r\n\t}\r\n\r\n\treset(smooth?: boolean) {\r\n\t\tsmooth = !!smooth;\r\n\t\tconst prevRemaining: number = this._remaining;\r\n\t\tthis._curInitial = this._remaining = this._initial[this._initialIndex];\r\n\t\tif (smooth && prevRemaining < 0) {\r\n\t\t\tthis._remaining += prevRemaining; // Subtract how much we went over\r\n\t\t}\r\n\t\tthis._initialIndex = (this._initialIndex + 1) % this._initial.length;\r\n\t\tif (this._minDelta || this._maxDelta) {\r\n\t\t\t//\t\t\t\tthis._remaining += Utils.randomInt(this._minDelta, this._maxDelta);\r\n\t\t}\r\n\t}\r\n\r\n\ttoString() {\r\n\t\treturn '[Delay: _initial=' + this._initial +\r\n\t\t\t', _remaining=' + this._remaining +\r\n\t\t\t', _loop=' + this._loop +\r\n\t\t\t', _callback=' + (this._callback != null) +\r\n\t\t\t']';\r\n\t}\r\n\r\n}\r\n","import {Delay} from './Delay';\n\ndescribe('Delay', () => {\n\n\tit('constructor happy path', () => {\n\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(49);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(1);\n\t\texpect(delay.isDone()).toEqual(true);\n\n\t});\n\n\t// it('constructor with required arguments not specified', () => {\n\t// \texpect(() => {\n\t// \t\tnew Delay(); // tslint:disable-line\n\t// \t}).toThrow();\n\t// \texpect(() => {\n\t// \t\tnew Delay({}); // tslint:disable-line\n\t// \t}).toThrow();\n\t// });\n\n\tit('constructor with delta specified', () => {\n\n\t\t// No delta specified\n\t\tlet delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getMinDelta()).toEqual(-1);\n\t\texpect(delay.getMaxDelta()).toEqual(-1);\n\n\t\t// Delta specified\n\t\tdelay = new Delay({millis: 100, minDelta: -5, maxDelta: 5});\n\t\texpect(delay.getMinDelta()).toEqual(-5);\n\t\texpect(delay.getMaxDelta()).toEqual(5);\n\n\t});\n\n\tit('update() without a callback', () => {\n\n\t\t// Calling update() with various millis passed until done.\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(49);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(1);\n\t\texpect(delay.isDone()).toEqual(true);\n\n\t});\n\n\tit('update() calls callback when not looping', () => {\n\n\t\tlet callbackCalled: boolean = false;\n\t\tconst cb: Function = () => {\n\t\t\tcallbackCalled = true;\n\t\t};\n\n\t\t// Calling update() with various millis passed until done.\n\t\tconst delay: Delay = new Delay({millis: 100, callback: cb});\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(49);\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(1);\n\t\texpect(callbackCalled).toEqual(true);\n\n\t});\n\n\tit('update() calls callback when looping', () => {\n\n\t\tlet callbackCalled: boolean = false;\n\t\tconst cb: Function = () => {\n\t\t\tcallbackCalled = true;\n\t\t};\n\n\t\t// Calling update() with various millis passed until done.\n\t\tconst delay: Delay = new Delay({millis: 100, callback: cb, loop: true});\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(true);\n\t\tcallbackCalled = false;\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(true);\n\t\tcallbackCalled = false;\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(callbackCalled).toEqual(true);\n\n\t});\n\n\tit('getLoopCount()', () => {\n\n\t\t// Looping not enabled => getLoopCount() always returns 0\n\t\tlet delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getLoopCount()).toEqual(0);\n\t\tdelay.update(100);\n\t\texpect(delay.isDone()).toEqual(true);\n\t\texpect(delay.getLoopCount()).toEqual(0);\n\n\t\t// Infinite looping => getLoopCount() updates on interval\n\t\tdelay = new Delay({millis: 100, loop: true});\n\t\texpect(delay.getLoopCount()).toEqual(0);\n\t\tdelay.update(100);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(1);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(1);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(2);\n\n\t\t// Fixed loop count => getLoopCount() increments to that number\n\t\tdelay = new Delay({millis: 100, loop: true, loopCount: 3});\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(0);\n\t\tdelay.update(100);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(1);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(1);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\texpect(delay.getLoopCount()).toEqual(2);\n\t\tdelay.update(100);\n\t\texpect(delay.isDone()).toEqual(true);\n\t\texpect(delay.getLoopCount()).toEqual(3);\n\t\tdelay.update(100);\n\t\texpect(delay.isDone()).toEqual(true);\n\t\texpect(delay.getLoopCount()).toEqual(3);\n\n\t});\n\n\tit('getMaxDelta()', () => {\n\n\t\tlet delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getMaxDelta()).toEqual(-1);\n\n\t\tdelay = new Delay({millis: 100, minDelta: -5, maxDelta: 5});\n\t\texpect(delay.getMaxDelta()).toEqual(5);\n\n\t});\n\n\tit('getMinDelta()', () => {\n\n\t\tlet delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getMinDelta()).toEqual(-1);\n\n\t\tdelay = new Delay({millis: 100, minDelta: -5, maxDelta: 5});\n\t\texpect(delay.getMinDelta()).toEqual(-5);\n\n\t});\n\n\tit('getRemaining()', () => {\n\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getRemaining()).toEqual(100);\n\t\tdelay.update(50);\n\t\texpect(delay.getRemaining()).toEqual(50);\n\t\tdelay.update(49);\n\t\texpect(delay.getRemaining()).toEqual(1);\n\t\tdelay.update(1);\n\t\texpect(delay.getRemaining()).toEqual(0);\n\n\t});\n\n\tit('getRemainingPercent()', () => {\n\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getRemainingPercent()).toEqual(1);\n\t\tdelay.update(50);\n\t\texpect(delay.getRemainingPercent()).toEqual(0.5);\n\t\tdelay.update(49);\n\t\texpect(delay.getRemainingPercent()).toEqual(0.01);\n\t\tdelay.update(1);\n\t\texpect(delay.getRemaining()).toEqual(0);\n\n\t});\n\n\tit('isDone()', () => {\n\n\t\t// Verify isDone() only returns true when total delay has passed.\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(50);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(49);\n\t\texpect(delay.isDone()).toEqual(false);\n\t\tdelay.update(1);\n\t\texpect(delay.isDone()).toEqual(true);\n\n\t});\n\n\tit('setRandomDelta()', () => {\n\n\t\t// Initially, no random delta\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.getMinDelta()).toEqual(-1);\n\t\texpect(delay.getMaxDelta()).toEqual(-1);\n\n\t\t// Setting a random delta\n\t\tdelay.setRandomDelta(-7, 7);\n\t\texpect(delay.getMinDelta()).toEqual(-7);\n\t\texpect(delay.getMaxDelta()).toEqual(7);\n\n\t});\n\n\tit('reset(smooth=true)', () => {\n\n\t\tconst delay: Delay = new Delay({millis: 100, loop: true});\n\t\texpect(delay.getRemaining()).toEqual(100);\n\t\tdelay.update(105); // Calls reset(true)\n\t\texpect(delay.getRemaining()).toEqual(95);\n\t});\n\n\tit('toString()', () => {\n\n\t\tconst delay: Delay = new Delay({millis: 100});\n\t\texpect(delay.toString()).toEqual('[Delay: _initial=100' +\n\t\t\t', _remaining=100' +\n\t\t\t', _loop=false' +\n\t\t\t', _callback=false' +\n\t\t\t']');\n\n\t});\n\n});\n","import {State} from './State';\r\n\r\nexport class FadeOutInState extends State {\r\n\r\n\tprivate _leavingState: State;\r\n\tprivate _enteringState: State;\r\n\tprivate _transitionLogic: Function | undefined;\r\n\tprivate _fadingOut: boolean;\r\n\tprivate _alpha: number;\r\n\tprivate _halfTime: number;\r\n\tprivate _curTime: number;\r\n\r\n\t/**\r\n\t * Fades one state out and another state in.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\tconstructor(leavingState: State, enteringState: State,\r\n\t\ttransitionLogic?: Function, timeMillis?: number) {\r\n\t\tsuper();\r\n\t\tthis._leavingState = leavingState;\r\n\t\tthis._enteringState = enteringState;\r\n\t\tthis._transitionLogic = transitionLogic;\r\n\t\tthis._fadingOut = true;\r\n\t\tthis._alpha = 1;\r\n\t\tthis._halfTime = timeMillis && timeMillis > 0 ? timeMillis / 2 : 800;\r\n\t\tthis._curTime = 0;\r\n\t}\r\n\r\n\tupdate(delta: number) {\r\n\r\n\t\tsuper.update(delta);\r\n\t\t//         console.log('delta === ' + delta);\r\n\t\tthis._curTime += delta;\r\n\t\tif (this._curTime >= this._halfTime) {\r\n\t\t\tthis._curTime -= this._halfTime;\r\n\t\t\tif (this._fadingOut) {\r\n\t\t\t\tthis._fadingOut = false;\r\n\t\t\t\tif (this._transitionLogic) {\r\n\t\t\t\t\tthis._transitionLogic();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._setState(this._enteringState);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._fadingOut) {\r\n\t\t\tthis._alpha = 1 - (this._curTime / this._halfTime);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._alpha = (this._curTime / this._halfTime);\r\n\t\t}\r\n\t}\r\n\r\n\trender(ctx: CanvasRenderingContext2D) {\r\n\r\n\t\tsuper.render(ctx);\r\n\t\tthis.game.clearScreen();\r\n\r\n\t\tconst previousAlpha: number = ctx.globalAlpha;\r\n\t\tctx.globalAlpha = this._alpha;\r\n\t\tif (this._fadingOut) {\r\n\t\t\tthis._leavingState.render(ctx);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._enteringState.render(ctx);\r\n\t\t}\r\n\t\tctx.globalAlpha = previousAlpha;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the new game state.  This is a hook for subclasses to perform\r\n\t * extra logic.\r\n\t *\r\n\t * @param state The new state.\r\n\t */\r\n\tprivate _setState(state: State) {\r\n\t\tthis.game.setState(this._enteringState);\r\n\t}\r\n}\r\n","import {FadeOutInState} from './FadeOutInState';\nimport {State} from './State';\n\ndescribe('FadeOutInState', () => {\n\t'use strict';\n\n\tit('constructor happy path', () => {\n\n\t\tconst leavingState: State = new State();\n\t\tconst enteringState: State = new State();\n\t\tconst temp: any = {\n\t\t\ttransitionLogic: () => {\n\t\t\t}\n\t\t};\n\t\tconst timeMillis: number = 500;\n\n\t\tspyOn(temp, 'transitionLogic');\n\n\t\tconst state: FadeOutInState = new FadeOutInState(leavingState, enteringState,\n\t\t\ttemp.transitionLogic, timeMillis);\n\t\texpect(state).toBeDefined();\n\t\texpect(temp.transitionLogic).not.toHaveBeenCalled();\n\t});\n\n\tit('transitionLogic is called at halfway point', () => {\n\n\t\tconst leavingState: State = new State();\n\t\tconst enteringState: State = new State();\n\t\tconst temp: any = {\n\t\t\ttransitionLogic: () => {\n\t\t\t}\n\t\t};\n\t\tconst timeMillis: number = 500;\n\n\t\tspyOn(temp, 'transitionLogic');\n\n\t\tconst state: FadeOutInState = new FadeOutInState(leavingState, enteringState,\n\t\t\ttemp.transitionLogic, timeMillis);\n\t\texpect(temp.transitionLogic).not.toHaveBeenCalled();\n\n\t\tstate.update(timeMillis / 2 - 1);\n\t\texpect(temp.transitionLogic).not.toHaveBeenCalled();\n\n\t\tstate.update(1);\n\t\texpect(temp.transitionLogic).toHaveBeenCalled();\n\t});\n\n});\n","import {Image} from './Image';\n\ndescribe('Image', () => {\n\t'use strict';\n\n\tit('constructor happy path - 1 arg', () => {\n\n\t\tconst canvas: HTMLCanvasElement = document.createElement('canvas');\n\t\tcanvas.width = 40;\n\t\tcanvas.height = 50;\n\n\t\tconst image: Image = new Image(canvas);\n\t\texpect(image.width).toEqual(canvas.width);\n\t\texpect(image.height).toEqual(canvas.height);\n\t\texpect(image.x).toEqual(0);\n\t\texpect(image.y).toEqual(0);\n\t});\n\n\tit('constructor happy path - 5 args', () => {\n\n\t\tconst canvas: HTMLCanvasElement = document.createElement('canvas');\n\t\tcanvas.width = 40;\n\t\tcanvas.height = 50;\n\n\t\tconst image: Image = new Image(canvas, 2, 2, 20, 20);\n\t\texpect(image.width).toEqual(20);\n\t\texpect(image.height).toEqual(20);\n\t\texpect(image.x).toEqual(2);\n\t\texpect(image.y).toEqual(2);\n\t});\n\n});\n","import {Image} from './Image';\r\nimport {ImageUtils} from './ImageUtils';\r\n\r\nexport class ImageAtlas {\r\n\r\n\tprivate _atlasInfo: any;\r\n\tprivate _masterCanvas: HTMLCanvasElement;\r\n\r\n\tconstructor(args: any) {\r\n\t\tthis._atlasInfo = args.atlasInfo;\r\n\t\tthis._masterCanvas = args.canvas;\r\n\t\tif (this._atlasInfo.firstPixelIsTranslucent) {\r\n\t\t\tthis._masterCanvas = ImageUtils.makeColorTranslucent(this._masterCanvas);\r\n\t\t}\r\n\t}\r\n\r\n\tparse() {\r\n\r\n\t\tconst images: { [id: string]: Image } = {};\r\n\t\tconst self: ImageAtlas = this;\r\n\r\n\t\tthis._atlasInfo.images.forEach((imgInfo: any) => {\r\n\r\n\t\t\tconst id: string = imgInfo.id;\r\n\t\t\tlet dim: any;\r\n\t\t\tif (imgInfo.dim) {\r\n\t\t\t\tdim = imgInfo.dim.split(/,\\s*/);\r\n\t\t\t\tif (dim.length !== 4) {\r\n\t\t\t\t\tthrow new Error('Invalid value for imgInfo.dim: ' + imgInfo.dim);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdim = [];\r\n\t\t\t\tdim.push(imgInfo.x, imgInfo.y, imgInfo.w, imgInfo.h);\r\n\t\t\t}\r\n\r\n\t\t\tdim = dim.map((str: string) => {\r\n\t\t\t\treturn parseInt(str, 10) * 2;\r\n\t\t\t});\r\n\r\n\t\t\timages[id] = new Image(self._masterCanvas, dim[0], dim[1], dim[2], dim[3]);\r\n\t\t});\r\n\r\n\t\treturn images;\r\n\t}\r\n}\r\n","/**\r\n * A simple x-y coordinate.\r\n */\r\nexport class Point {\r\n\r\n\tx: number;\r\n\ty: number;\r\n\r\n\t/**\r\n\t * Creates a <code>Point</code> instance.\r\n\t * @param {number} x The x-coordinate, or <code>0</code> if unspecified.\r\n\t * @param {number} y The y-coordinate, or <code>0</code> if unspecified.\r\n\t */\r\n\tconstructor(x: number = 0, y: number = 0) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this point is equal to another one.\r\n\t * @param {Point} other The point to compare to, which may be\r\n\t *        <code>null</code>.\r\n\t * @return Whether the two points are equal.\r\n\t */\r\n\tequals(other: Point | null): boolean {\r\n\t\treturn other != null && this.x === other.x && this.y === other.y;\r\n\t}\r\n}\r\n","import {Point} from './Point';\r\n\r\ndescribe('Point', () => {\r\n\t'use strict';\r\n\r\n\tit('constructor 0-arg', () => {\r\n\t\tconst point: Point = new Point();\r\n\t\texpect(point.x).toBe(0);\r\n\t\texpect(point.y).toBe(0);\r\n\t});\r\n\r\n\tit('constructor 1-arg', () => {\r\n\t\tconst point: Point = new Point(3);\r\n\t\texpect(point.x).toBe(3);\r\n\t\texpect(point.y).toBe(0);\r\n\t});\r\n\r\n\tit('constructor 2-arg', () => {\r\n\t\tconst point: Point = new Point(3, 4);\r\n\t\texpect(point.x).toBe(3);\r\n\t\texpect(point.y).toBe(4);\r\n\t});\r\n\r\n\tit('equals null arg', () => {\r\n\t\tconst point: Point = new Point(3, 4);\r\n\t\texpect(point.equals(null)).toBeFalsy();\r\n\t});\r\n\r\n\tit('equals false', () => {\r\n\t\tconst point: Point = new Point(3, 4);\r\n\t\tconst point2: Point = new Point(3, 5);\r\n\t\texpect(point.equals(point2)).toBeFalsy();\r\n\t});\r\n\r\n\tit('equals true', () => {\r\n\t\tconst point: Point = new Point(3, 4);\r\n\t\tconst point2: Point = new Point(3, 4);\r\n\t\texpect(point.equals(point2)).toBeTruthy();\r\n\t\texpect(point.equals(point)).toBeTruthy();\r\n\t});\r\n\r\n});\r\n","/**\r\n * An object pool.\tUseful if your game creates lots of very small\r\n * objects of the same type each frame, such as a path-finding algorithm.\r\n * <p>\r\n * NOTE: The <code>returnObj()</code> method may take linear time;\r\n * it's much more efficient to use <code>reset()</code> if possible.\r\n */\r\nexport class Pool<T> {\r\n\r\n\tprivate _pool: T[];\r\n\tprivate _index: number;\r\n\tprivate _growCount: number;\r\n\tprivate _c: { new(): T };\r\n\r\n\t/**\r\n\t * Creates an object pool.\r\n\t * @param {Function} ctorFunc The constructor function for <code>T</code>\r\n\t *        instances.\r\n\t * @param {number} initialSize The initial size of the pool; defaults to\r\n\t *        <code>20</code>.\r\n\t * @param {number} growCount The amount to grow this pool by if too many\r\n\t *        objects are borrowed; defaults to <code>10</code>.\r\n\t */\r\n\tconstructor(ctorFunc: { new(): T }, initialSize: number = 20,\r\n\t\t\t\tgrowCount: number = 10) {\r\n\t\tthis._c = ctorFunc;\r\n\t\tthis._pool = [];\r\n\t\tfor (let i: number = 0; i < initialSize; i++) {\r\n\t\t\tthis._pool.push(new this._c());\r\n\t\t}\r\n\t\tthis._index = 0;\r\n\t\tthis._growCount = growCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an object from this pool.\r\n\t * @return {T} An object from this pool.\r\n\t * @see returnObj\r\n\t */\r\n\tborrowObj(): T {\r\n\t\tlet obj: T = this._pool[this._index++];\r\n\t\tif (this._index >= this._pool.length) {\r\n\t\t\tfor (let i: number = 0; i < this._growCount; i++) {\r\n\t\t\t\tthis._pool.push(new this._c());\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the number of currently-borrowed objects.\r\n\t * @return {number} The number of currently-borrowed objects.\r\n\t */\r\n\tget borrowedCount(): number {\r\n\t\treturn this._index;\r\n\t}\r\n\r\n\t/**\r\n\t * Acts as if all objects have been returned to this pool.\tThis method\r\n\t * should be used if you're implementing an algorithm that uses an\r\n\t * arbitrary number of objects, and just want to return them all when you\r\n\t * are done.\r\n\t * @see returnObj\r\n\t */\r\n\treset() {\r\n\t\tthis._index = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an object to this pool.\r\n\t * @param {T} obj The object to return.\r\n\t * @return {boolean} <code>true</code>, assuming the object was actually\r\n\t *         from this pool, and not previously returned.\tIn other words,\r\n\t *         this method will only return <code>false</code> if you try to\r\n\t *         incorrectly return an object.\r\n\t * @see borrowObj\r\n\t * @see reset\r\n\t */\r\n\treturnObj(obj: T): boolean {\r\n\r\n\t\t// Get the index of the object being returned.\r\n\t\tlet objIndex: number = -1;\r\n\t\tfor (let i: number = 0; i < this._index; i++) {\r\n\t\t\tif (obj === this._pool[i]) {\r\n\t\t\t\tobjIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (objIndex === -1) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Swap it with the most-recently borrowed object and move our index back\r\n\t\tlet temp: T = this._pool[--this._index];\r\n\t\tthis._pool[this._index] = this._pool[objIndex];\r\n\t\tthis._pool[objIndex] = temp;\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the total number of pooled objects, borrowed or otherwise.\r\n\t * Only really useful for debugging purposes.\r\n\t * @return {number} The total number of objects in this pool.\r\n\t */\r\n\tget length(): number {\r\n\t\treturn this._pool.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns this object as a string.\tUseful for debugging.\r\n\t * @return {string} A string representation of this pool.\r\n\t */\r\n\ttoString(): string {\r\n\t\treturn '[Pool: ' +\r\n\t\t\t\t'borrowed=' + this.borrowedCount +\r\n\t\t\t\t', size=' + this.length +\r\n\t\t\t\t']';\r\n\t}\r\n}\r\n","import {Pool} from './Pool';\r\n\r\ndescribe('Pool', () => {\r\n\t'use strict';\r\n\r\n\tfunction Widget() { // tslint:disable-line\r\n\t\tthis.type = null;\r\n\t\tthis.price = 0;\r\n\t}\r\n\r\n\tit('constructor, 0-arg', () => {\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\t\texpect(pool.length).toBe(20);\r\n\t});\r\n\r\n\tit('constructor, 1-arg', () => {\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor, 50);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\t\texpect(pool.length).toBe(50);\r\n\t});\r\n\r\n\tit('borrowObj() happy path', () => {\r\n\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\r\n\t\tconst widget: any = pool.borrowObj();\r\n\t\texpect(pool.borrowedCount).toBe(1);\r\n\t\texpect(widget.type).toBeNull();\r\n\t\texpect(widget.price).toBe(0);\r\n\r\n\t\tpool.returnObj(widget);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\t});\r\n\r\n\tit('borrowObj() until pool grown', () => {\r\n\r\n\t\tconst growCount: number = 7;\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor, 3, growCount);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\r\n\t\tpool.borrowObj();\r\n\t\tpool.borrowObj();\r\n\t\tpool.borrowObj();\r\n\t\texpect(pool.borrowedCount).toBe(3);\r\n\t\texpect(pool.length).toBe(3 + growCount);\r\n\t});\r\n\r\n\tit('returnObj() happy path', () => {\r\n\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\r\n\t\tconst widget: any = pool.borrowObj();\r\n\t\texpect(pool.borrowedCount).toBe(1);\r\n\t\texpect(widget.type).toBeNull();\r\n\t\texpect(widget.price).toBe(0);\r\n\r\n\t\tconst result: any = pool.returnObj(widget);\r\n\t\texpect(result).toBeTruthy();\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\t});\r\n\r\n\tit('returnObj() invalid object', () => {\r\n\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\r\n\t\tconst result: any = pool.returnObj('hello world');\r\n\t\texpect(result).toBeFalsy();\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\t});\r\n\r\n\tit('reset() happy path', () => {\r\n\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor);\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\r\n\t\tpool.borrowObj();\r\n\t\tpool.borrowObj();\r\n\t\tpool.borrowObj();\r\n\t\texpect(pool.borrowedCount).toBe(3);\r\n\r\n\t\tpool.reset();\r\n\t\texpect(pool.borrowedCount).toBe(0);\r\n\t});\r\n\r\n\tit('toString()', () => {\r\n\t\tconst pool: Pool<any> = new Pool<any>(Widget.prototype.constructor);\r\n\t\tconst actual: string = pool.toString();\r\n\t\texpect(actual).toBe('[Pool: borrowed=0, size=20]');\r\n\t});\r\n});\r\n","export class Rectangle {\r\n\r\n\tx: number;\r\n\ty: number;\r\n\tw: number;\r\n\th: number;\r\n\r\n\t/**\r\n\t * A simple rectangle class, containing some useful utility methods.\r\n\t *\r\n\t * @constructor\r\n\t * @param {int} x The x-coordinate, defaulting to <code>0</code>.\r\n\t * @param {int} y The y-coordinate, defaulting to <code>0</code>.\r\n\t * @param {int} w The width of the rectangle, defaulting to <code>0</code>.\r\n\t * @param {int} h The height of the rectangle, defaulting to <code>0</code>.\r\n\t */\r\n\tconstructor(x: number = 0, y: number = 0, w: number = 0, h: number = 0) {\r\n\t\tthis.set(x, y, w, h);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether one rectangle contains another.\r\n\t *\r\n\t * @param {number|Rectangle} x2 Either a second rectangle, or the\r\n\t *        x-coordinate of the second rectangle.\r\n\t * @param {number} y2 The y-coordinate of the second rectangle, if\r\n\t *        specifying the dimensions as separate arguments.\r\n\t * @param {number} w2 The width of the second rectangle, if\r\n\t *        specifying the dimensions as separate arguments.\r\n\t * @param {number} h2 The height of the second rectangle, if\r\n\t *        specifying the dimensions as separate arguments.\r\n\t * @return Whether this rectangle contains the specified rectangle.\r\n\t */\r\n\tcontainsRect(x2: number|Rectangle, y2: number = 0, w2: number = 0, h2: number = 0) {\r\n\r\n\t\tif (x2 instanceof Rectangle) {\r\n\t\t\tconst r: Rectangle = <Rectangle>x2;\r\n\t\t\ty2 = r.y;\r\n\t\t\tw2 = r.w;\r\n\t\t\th2 = r.h;\r\n\t\t\tx2 = r.x;\r\n\t\t}\r\n\r\n\t\tlet w: number = this.w;\r\n\t\tlet h: number = this.h;\r\n\t\tif ((w | h | w2 | h2) < 0) {\r\n\t\t\t\t// At least one of the dimensions is negative...\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t// Note: if any dimension is zero, tests below must return false...\r\n\t\tlet x: number = this.x;\r\n\t\tlet y: number = this.y;\r\n\t\tif (x2 < x || y2 < y) {\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\tw += x;\r\n\t\tw2 += <number>x2;\r\n\t\tif (w2 <= x2) {\r\n\t\t\t\t// X+W overflowed or W was zero, return false if...\r\n\t\t\t\t// either original w or W was zero or\r\n\t\t\t\t// x+w did not overflow or\r\n\t\t\t\t// the overflowed x+w is smaller than the overflowed X+W\r\n\t\t\t\tif (w >= x || w2 > w) { return false; }\r\n\t\t} else {\r\n\t\t\t\t// X+W did not overflow and W was not zero, return false if...\r\n\t\t\t\t// original w was zero or\r\n\t\t\t\t// x+w did not overflow and x+w is smaller than X+W\r\n\t\t\t\tif (w >= x && w2 > w) { return false; }\r\n\t\t}\r\n\t\th += y;\r\n\t\th2 += y2;\r\n\t\tif (h2 <= y2) {\r\n\t\t\t\tif (h >= y || h2 > h) { return false; }\r\n\t\t} else {\r\n\t\t\t\tif (h >= y && h2 > h) { return false; }\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this rectangle intersects another.\r\n\t *\r\n\t * @param {Rectangle} rect2 Another rectangle to compare against.\r\n\t *        This should not be null.\r\n\t * @return {boolean} Whether the two rectangles intersect.\r\n\t */\r\n\tintersects(rect2: Rectangle): boolean {\r\n\r\n\t\tlet tw: number = this.w;\r\n\t\tlet th: number = this.h;\r\n\t\tlet rw: number = rect2.w;\r\n\t\tlet rh: number = rect2.h;\r\n\t\tif (rw <= 0 || rh <= 0 || tw <= 0 || th <= 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tlet tx: number = this.x;\r\n\t\tlet ty: number = this.y;\r\n\t\tlet rx: number = rect2.x;\r\n\t\tlet ry: number = rect2.y;\r\n\t\trw += rx;\r\n\t\trh += ry;\r\n\t\ttw += tx;\r\n\t\tth += ty;\r\n\t\t//      overflow || intersect\r\n\t\treturn ((rw < rx || rw > tx) &&\r\n\t\t\t(rh < ry || rh > ty) &&\r\n\t\t\t(tw < tx || tw > rx) &&\r\n\t\t\t(th < ty || th > ry));\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the bounds of this rectangle.\r\n\t * @param {number} x The new x-coordinate.\r\n\t * @param {number} y The new y-coordinate.\r\n\t * @param {number} w The new width.\r\n\t * @param {number} h The new height.\r\n\t */\r\n\tset(x: number, y: number, w: number, h: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.w = w;\r\n\t\tthis.h = h;\r\n\t}\r\n}\r\n","import {Rectangle} from './Rectangle';\n\ndescribe('Rectangle', () => {\n\t'use strict';\n\n\tit('0-arg constructor happy path', () => {\n\t\tconst rect: Rectangle = new Rectangle();\n\t\texpect(rect.x).toEqual(0);\n\t\texpect(rect.y).toEqual(0);\n\t\texpect(rect.w).toEqual(0);\n\t\texpect(rect.h).toEqual(0);\n\t});\n\n\tit('4-arg constructor happy path', () => {\n\t\tconst rect: Rectangle = new Rectangle(42, 41, 40, 39);\n\t\texpect(rect.x).toEqual(42);\n\t\texpect(rect.y).toEqual(41);\n\t\texpect(rect.w).toEqual(40);\n\t\texpect(rect.h).toEqual(39);\n\t});\n\n\tit('containsRect happy path - true', () => {\n\t\tconst r1: Rectangle = new Rectangle(5, 5, 20, 20);\n\t\tconst r2: Rectangle = new Rectangle(7, 7, 5, 5);\n\t\texpect(r1.containsRect(r2)).toEqual(true);\n\t});\n\n\tit('containsRect happy path - false', () => {\n\t\tconst r1: Rectangle = new Rectangle(5, 5, 20, 20);\n\t\tconst r2: Rectangle = new Rectangle(0, 0, 25, 25);\n\t\texpect(r1.containsRect(r2)).toEqual(false);\n\t});\n\n\tit('containsRect - identical rectangles', () => {\n\t\tconst r1: Rectangle = new Rectangle(5, 5, 20, 20);\n\t\tconst r2: Rectangle = new Rectangle(5, 5, 20, 20);\n\t\texpect(r1.containsRect(r2)).toEqual(true);\n\t});\n\n\tit('containsRect - negative width or height', () => {\n\t\tlet r1: Rectangle = new Rectangle(5, 5, -1, 5);\n\t\tlet r2: Rectangle = new Rectangle(5, 5, 20, 20);\n\t\texpect(r1.containsRect(r2)).toEqual(false);\n\t\texpect(r2.containsRect(r1)).toEqual(false);\n\n\t\tr1 = new Rectangle(5, 5, 5, -1);\n\t\tr2 = new Rectangle(5, 5, 20, 20);\n\t\texpect(r1.containsRect(r2)).toEqual(false);\n\t\texpect(r2.containsRect(r1)).toEqual(false);\n\t});\n\n\tit('containsRect - edge case 1 for coverage', () => {\n\t\t// w2 === 0, w1 >= x1\n\t\tconst r1: Rectangle = new Rectangle(5, 5, 10, 5);\n\t\tconst r2: Rectangle = new Rectangle(5, 5, 0, 20);\n\t\texpect(r1.containsRect(r2)).toEqual(false);\n\t});\n\n\tit('containsRect - edge case 2 for coverage', () => {\n\t\t// w2 > x2 && w1 >= x1 && w2 > w1\n\t\tconst r1: Rectangle = new Rectangle(5, 5, 10, 5);\n\t\tconst r2: Rectangle = new Rectangle(5, 5, 15, 20);\n\t\texpect(r1.containsRect(r2)).toEqual(false);\n\t});\n\n\tit('intersects happy path - false', () => {\n\t\tconst r1: Rectangle = new Rectangle(0, 0, 20, 20);\n\t\tconst r2: Rectangle = new Rectangle(50, 50, 4, 4);\n\t\texpect(r1.intersects(r2)).toEqual(false);\n\t\texpect(r2.intersects(r1)).toEqual(false);\n\t});\n\n\tit('intersects - invalid rect, negative width', () => {\n\t\tconst r1: Rectangle = new Rectangle(20, 20, -4, -4);\n\t\tconst r2: Rectangle = new Rectangle(50, 50, 4, 4);\n\t\texpect(r1.intersects(r2)).toEqual(false);\n\t\texpect(r2.intersects(r1)).toEqual(false);\n\t});\n\n\tit('intersects happy path - true', () => {\n\t\tconst r1: Rectangle = new Rectangle(0, 0, 20, 20);\n\t\tconst r2: Rectangle = new Rectangle(10, 10, 20, 20);\n\t\texpect(r1.intersects(r2)).toEqual(true);\n\t\texpect(r2.intersects(r1)).toEqual(true);\n\t});\n\n\tit('intersects, one containing another', () => {\n\t\tconst r1: Rectangle = new Rectangle(0, 0, 20, 20);\n\t\tconst r2: Rectangle = new Rectangle(5, 5, 5, 5);\n\t\texpect(r1.intersects(r2)).toEqual(true);\n\t\texpect(r2.intersects(r1)).toEqual(true);\n\t});\n\n\tit('set', () => {\n\t\tconst r1: Rectangle = new Rectangle(0, 0, 20, 20);\n\t\tr1.set(5, 6, 7, 8);\n\t\texpect(r1.x).toBe(5);\n\t\texpect(r1.y).toBe(6);\n\t\texpect(r1.w).toBe(7);\n\t\texpect(r1.h).toBe(8);\n\t});\n});\n","/**\r\n * An enum of available stretch modes for games.  While typically used in desktop games, this can be used\r\n * in the browser as well, to allow the game to resize as the window is resized, according to their personal\r\n * preferences.<p>\r\n *\r\n * Note that for stretch modes to work, it is assumed that CSS is set up for the application similar to the\r\n * following, to allow stretching:\r\n *\r\n * <pre>\r\n * * {\r\n *    margin: 0;\r\n *    padding: 0;\r\n * }\r\n * html, body {\r\n *    width: 100%;\r\n *    height: 100%;\r\n * }\r\n * </pre>\r\n *\r\n * <ul>\r\n *    <li><code>STRETCH_NONE</code> renders the game in its \"native\" resolution.\r\n *    <li><code>STRETCH_FILL</code> makes the canvas fill the parent document.\r\n *    <li><code>STRETCH_PROPORTIONAL</code> stretches the canvas so it is as large as possible in the\r\n *       parent document, while maintaining its original aspect ratio.\r\n * </ul>\r\n */\r\nexport enum StretchMode {\r\n\r\n\t/**\r\n\t * No stretching is done.  If the area to paint in is smaller than\r\n\t * the game's native resolution, the area painted is clipped.  If the\r\n\t * area to paint is larger than the game's native resolution, then\r\n\t * the extra area is filled with some solid color (e.g. black or white).\r\n\t */\r\n\tSTRETCH_NONE,\r\n\r\n\t/**\r\n\t * The game's graphics are stretched to completely fill the window in\r\n\t * which they are being displayed.\r\n\t */\r\n\tSTRETCH_FILL,\r\n\r\n\t/**\r\n\t * The game's graphics are stretched so that they fill as much as possible\r\n\t * of the window in which they're being displayed, while maintaining their\r\n\t * proper aspect ratio.\r\n\t */\r\n\tSTRETCH_PROPORTIONAL\r\n}\r\n\r\n/**\r\n * Utility methods to allow desktop games to resize to fit their parent document.  Typically, you will\r\n * register an <code>onresize</code> listener on the document body, and call <code>CanvasResizer.resize()</code>\r\n * with the appropriate stretch mode parameter.  This allows the user to specify whether they want the game\r\n * to stretch to fit, keep proportion, or display in its original resolution.<p>\r\n *\r\n * Note that for stretch modes to work, it is assumed that CSS is set up for the application similar to the\r\n * following, to allow stretching:\r\n *\r\n * <pre>\r\n * * {\r\n *    margin: 0;\r\n *    padding: 0;\r\n * }\r\n * html, body {\r\n *    width: 100%;\r\n *    height: 100%;\r\n * }\r\n * </pre>\r\n */\r\nexport class CanvasResizer {\r\n\r\n\t/**\r\n\t * Resizes a canvas to use the specified stretch mode.\r\n\t *\r\n\t * @param {HTMLCanvasElement} canvas The canvas to resize.\r\n\t * @param {StretchMode} stretchMode The stretch mode to apply.\r\n\t */\r\n\tstatic resize(canvas: HTMLCanvasElement, stretchMode: StretchMode) {\r\n\r\n\t\tswitch (stretchMode) {\r\n\r\n\t\t\tdefault:\r\n\t\t\tcase StretchMode.STRETCH_NONE:\r\n\t\t\t\tcanvas.style.width = canvas.width + 'px';\r\n\t\t\t\tcanvas.style.height = canvas.height + 'px';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase StretchMode.STRETCH_FILL:\r\n\t\t\t\tcanvas.style.width = document.body.clientWidth + 'px';\r\n\t\t\t\tcanvas.style.height = document.body.clientHeight + 'px';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase StretchMode.STRETCH_PROPORTIONAL:\r\n\t\t\t\tconst xFactor: number = document.body.clientWidth / (canvas.width * 1.0);\r\n\t\t\t\tconst yFactor: number = document.body.clientHeight / (canvas.height * 1.0);\r\n\t\t\t\tconst factor: number = Math.min(xFactor, yFactor);\r\n\t\t\t\tcanvas.style.width = Math.floor(canvas.width * factor) + 'px';\r\n\t\t\t\tcanvas.style.height = Math.floor(canvas.height * factor) + 'px';\r\n\t\t\t\t// Centering should be handled via CSS\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t}\r\n}\r\n","import {Timer} from './Timer';\n\ndescribe('Timer', () => {\n\t'use strict';\n\n\tlet debugContent: string,\n\t\terrorContent: string;\n\n\tbeforeEach(() => {\n\n\t\tdebugContent = '';\n\t\terrorContent = '';\n\n\t\t// Note we are assuming that console.log/error are called with 1 argument\n\t\t// here...\n\t\tspyOn(console, 'log')\n\t\t\t.and.callFake((arg: any) => {\n\t\t\tdebugContent += arg + '\\n';\n\t\t});\n\t\tspyOn(console, 'error')\n\t\t\t.and.callFake((arg: any) => {\n\t\t\terrorContent += arg + '\\n';\n\t\t});\n\t});\n\n\tit('logging, happy path, single event', () => {\n\n\t\tconst timer: Timer = new Timer();\n\n\t\ttimer.start('work');\n\t\ttimer.endAndLog('work');\n\n\t\texpect(debugContent).toMatch(/^DEBUG: work: [\\d.]+ ms/);\n\t});\n\n\tit('logging, unknown key passed to endAndLog', () => {\n\n\t\tconst timer: Timer = new Timer();\n\n\t\ttimer.start('work');\n\t\ttimer.endAndLog('twerk');\n\n\t\texpect(debugContent).toBe('');\n\t\texpect(errorContent).toBe('Cannot end timer for \"twerk\" as it was never started\\n');\n\t});\n\n\tit('setLogPrefix, new value', () => {\n\n\t\tconst timer: Timer = new Timer();\n\t\ttimer.setLogPrefix('TEST');\n\n\t\ttimer.start('work');\n\t\ttimer.endAndLog('work');\n\n\t\texpect(debugContent).toMatch(/^TEST: work: [\\d.]+ ms/);\n\t});\n\n\tit('setLogPrefix, resetting to default', () => {\n\n\t\tconst timer: Timer = new Timer();\n\t\ttimer.setLogPrefix('TEST');\n\n\t\ttimer.start('work');\n\t\ttimer.endAndLog('work');\n\n\t\texpect(debugContent).toMatch(/^TEST: work: [\\d.]+ ms/);\n\n\t\ttimer.setLogPrefix(); // Should reset\n\n\t\ttimer.start('work2');\n\t\ttimer.endAndLog('work2');\n\n\t\texpect(debugContent).toMatch(/^TEST: work: [\\d.]+ ms\\nDEBUG: work2: [\\d.]+ ms/);\n\t});\n\n});\n","import {Utils} from './Utils';\nimport {BrowserUtil} from './BrowserUtil';\n\ndescribe('Utils', () => {\n\t'use strict';\n\n\tit('constructor happy path, even though not used', () => {\n\t\tconst utils: Utils = new Utils();\n\t\texpect(utils).not.toBeNull();\n\t});\n\n\tit('getObjectSize() happy path', () => {\n\n\t\tlet obj: any = {};\n\t\texpect(Utils.getObjectSize(obj)).toBe(0);\n\n\t\tobj = {one: 1, two: 2};\n\t\texpect(Utils.getObjectSize(obj)).toBe(2);\n\t});\n\n\tit('getRequestParam() param found, no values, multiple params', () => {\n\n\t\tspyOn(BrowserUtil, 'getWindowLocationSearch')\n\t\t\t.and.returnValue('?foo&bar&bas');\n\n\t\texpect(Utils.getRequestParam('foo')).toBe('');\n\t\texpect(Utils.getRequestParam('bar')).toBe('');\n\t\texpect(Utils.getRequestParam('bas')).toBe('');\n\t});\n\n\tit('getRequestParam() param found, values, multiple params', () => {\n\n\t\tspyOn(BrowserUtil, 'getWindowLocationSearch')\n\t\t\t.and.returnValue('?foo=fooValue&bar=barValue&bas=basValue');\n\n\t\texpect(Utils.getRequestParam('foo')).toBe('fooValue');\n\t\texpect(Utils.getRequestParam('bar')).toBe('barValue');\n\t\texpect(Utils.getRequestParam('bas')).toBe('basValue');\n\t});\n\n\tit('getRequestParam() param not found', () => {\n\n\t\tspyOn(BrowserUtil, 'getWindowLocationSearch')\n\t\t\t.and.returnValue('?foo=fooValue&bar=barValue&bas=basValue');\n\n\t\texpect(Utils.getRequestParam('notFound')).toBeNull();\n\t});\n\n\tit('getRequestParam() param not found, substring of param', () => {\n\n\t\tspyOn(BrowserUtil, 'getWindowLocationSearch')\n\t\t\t.and.returnValue('?debugMode=true');\n\n\t\texpect(Utils.getRequestParam('debug')).toBeNull();\n\t});\n\n\tit('randomInt(), max only', () => {\n\n\t\texpect(Utils.randomInt(1)).toBe(0);\n\n\t\tconst result: number = Utils.randomInt(5);\n\t\texpect(result >= 0).toBeTruthy();\n\t\texpect(result).toBeLessThan(5);\n\t});\n\n\tit('randomInt(), min and max', () => {\n\n\t\tlet result: number = Utils.randomInt(1);\n\t\texpect(result).toBe(0);\n\n\t\tresult = Utils.randomInt(0, 5);\n\t\texpect(result >= 0).toBeTruthy();\n\t\texpect(result).toBeLessThan(5);\n\n\t\tresult = Utils.randomInt(100, 150);\n\t\texpect(result >= 100).toBeTruthy();\n\t\texpect(result).toBeLessThan(150);\n\t});\n\n\tit('timestamp()', () => {\n\n\t\tconst DELAY: number = 100;\n\n\t\tconst start: number = Utils.timestamp();\n\t\tconst waitUntil: number = Date.now() + DELAY + 1; // Wait > 100 milliseconds\n\t\twhile (Date.now() < waitUntil) {}\n\t\tconst end: number = Utils.timestamp();\n\t\texpect(end).toBeGreaterThan(start + DELAY);\n\t});\n\n\tit('initConsole() with console defined', () => {\n\t\tconst mockConsole: any = {\n\t\t\tinfo: 1,\n\t\t\tlog: 2,\n\t\t\twarn: 3,\n\t\t\t'error': 4\n\t\t};\n\t\tconst origConsole: Console = window.console;\n\t\t(<any>window).console = mockConsole;\n\t\tUtils.initConsole();\n\t\texpect(window.console).toBe(mockConsole);\n\t\t(<any>window).console = origConsole;\n\t});\n\n\tit('initConsole() with console undefined', () => {\n\t\tconst origConsole: Console = window.console;\n\t\t(<any>window).console = null;\n\t\tUtils.initConsole();\n\t\texpect(window.console).not.toBeNull();\n\t\t(<any>window).console = origConsole;\n\t});\n});\n"]}