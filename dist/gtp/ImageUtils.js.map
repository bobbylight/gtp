{"version":3,"sources":["gtp/ImageUtils.ts"],"names":["gtp","gtp.ImageUtils","gtp.ImageUtils.constructor","gtp.ImageUtils.resize","gtp.ImageUtils.createCanvas","gtp.ImageUtils.prepCanvas","gtp.ImageUtils.makeColorTranslucent"],"mappings":"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","file":"gtp/ImageUtils.js","sourcesContent":["module gtp {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * General-purpose utilities for manipulating images in canvases.\r\n\t * @constructor\r\n\t */\r\n\texport class ImageUtils {\r\n\r\n\t\t/**\r\n\t\t * If <code>true</code>, subpixel rendering is allowed; otherwise, x- and\r\n\t\t * y-coordinates are rounded to the nearest integer when rendering images.\r\n\t\t */\r\n\t\tstatic allowSubpixelImageRendering: boolean = false;\r\n\r\n\t\t/**\r\n\t\t * Takes an img/canvas and a scaling factor and returns the scaled image.\r\n\t\t * @method\r\n\t\t */\r\n\t\tstatic resize(img: HTMLImageElement|HTMLCanvasElement, scale: number = 1): HTMLCanvasElement {\r\n\r\n\t\t\t// The original image is drawn into an offscreen canvas of the same size\r\n\t\t\t// and copied, pixel by pixel into another offscreen canvas with the\r\n\t\t\t// new size.\r\n\r\n\t\t\tvar orig: HTMLCanvasElement,\r\n\t\t\t\torigCtx: CanvasRenderingContext2D;\r\n\r\n\t\t\tif (img instanceof HTMLImageElement) {\r\n\t\t\t\torig = gtp.ImageUtils.createCanvas(img.width, img.height);\r\n\t\t\t\torigCtx = orig.getContext('2d');\r\n\t\t\t\torigCtx.drawImage(img, 0, 0);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\torig = <HTMLCanvasElement>img;\r\n\t\t\t\torigCtx = orig.getContext('2d');\r\n\t\t\t}\r\n\r\n\t\t\tif (scale === 1) {\r\n\t\t\t\treturn orig; // No reason to scale\r\n\t\t\t}\r\n\r\n\t\t\tvar origPixels: ImageData = origCtx.getImageData(0, 0, img.width, img.height);\r\n\r\n\t\t\tvar widthScaled: number = img.width * scale;\r\n\t\t\tvar heightScaled: number = img.height * scale;\r\n\t\t\tvar scaled: HTMLCanvasElement = gtp.ImageUtils.createCanvas(widthScaled, heightScaled);\r\n\t\t\tvar scaledCtx: CanvasRenderingContext2D = scaled.getContext('2d');\r\n\t\t\tvar scaledPixels: ImageData = scaledCtx.getImageData(0, 0, widthScaled, heightScaled);\r\n\r\n\t\t\tfor (var y: number = 0; y < heightScaled; y++) {\r\n\t\t\t\tfor (var x: number = 0; x < widthScaled; x++) {\r\n\t\t\t\t\tvar index: number = (Math.floor(y / scale) * img.width + Math.floor(x / scale)) * 4;\r\n\t\t\t\t\tvar indexScaled: number = (y * widthScaled + x) * 4;\r\n\t\t\t\t\tscaledPixels.data[indexScaled] = origPixels.data[index];\r\n\t\t\t\t\tscaledPixels.data[indexScaled + 1] = origPixels.data[index + 1];\r\n\t\t\t\t\tscaledPixels.data[indexScaled + 2] = origPixels.data[index + 2];\r\n\t\t\t\t\tscaledPixels.data[indexScaled + 3] = origPixels.data[index + 3];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tscaledCtx.putImageData(scaledPixels, 0, 0);\r\n\t\t\treturn scaled;\r\n\t\t}\r\n\r\n\t\tstatic createCanvas(width: number, height: number, parentDiv?: HTMLElement|string) {\r\n\r\n\t\t\tvar canvas: HTMLCanvasElement = document.createElement('canvas');\r\n\t\t\tcanvas.width = width;\r\n\t\t\tcanvas.height = height;\r\n\t\t\tgtp.ImageUtils.prepCanvas(canvas);\r\n\r\n\t\t\tif (parentDiv) {\r\n\r\n\t\t\t\tvar actualParent: HTMLElement;\r\n\t\t\t\tif (typeof parentDiv === 'string') {\r\n\t\t\t\t\tactualParent = document.getElementById(parentDiv);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tactualParent = parentDiv;\r\n\t\t\t\t}\r\n\t\t\t\t// Clear previous contents in place there was a placeholder image\r\n\t\t\t\tactualParent.innerHTML = '';\r\n\t\t\t\tactualParent.appendChild(canvas);\r\n\t\t\t}\r\n\r\n\t\t\treturn canvas;\r\n\t\t}\r\n\r\n\t\tstatic prepCanvas(canvas: HTMLCanvasElement) {\r\n\t\t\t// Use \"any\" instead of \"CanvasRenderingContext2D\" since  the TypeScript definition\r\n\t\t\t// files don't like the experimental *imageSmoothingEnabled properties\r\n\t\t\tvar ctx: any = canvas.getContext('2d');\r\n\t\t\tctx.imageSmoothingEnabled = false;\r\n\t\t\tctx.mozImageSmoothingEnabled = false;\r\n\t\t\tctx.oImageSmoothingEnabled = false;\r\n\t\t\tctx.webkitImageSmoothingEnabled = false;\r\n\t\t\tctx.msImageSmoothingEnabled = false;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Converts a color of a particular type to completely transparent in a canvas.\r\n\t\t *\r\n\t\t * @param {Canvas} canvas The canvas to operate on.\r\n\t\t * @param {int} x The x-coordinate of the pixel whose color to change.  0 will\r\n\t\t *        be used if this parameter is undefined.\r\n\t\t * @param {int} y The y-coordinate of the pixel whose color to change.  0 will\r\n\t\t *        be used if this parameter is undefined.\r\n\t\t * @return {Canvas} The original canvas, which has been modified.\r\n\t\t * @method\r\n\t\t */\r\n\t\tstatic makeColorTranslucent(canvas: HTMLCanvasElement, x: number = 0, y: number = 0) {\r\n\r\n\t\t\tvar ctx: CanvasRenderingContext2D = canvas.getContext('2d');\r\n\t\t\tvar w: number = canvas.width;\r\n\t\t\tvar h: number = canvas.height;\r\n\t\t\tvar pixels: ImageData = ctx.getImageData(0, 0, w, h);\r\n\r\n\t\t\tvar color: number[] = [];\r\n\t\t\tvar offs: number = (y * w + x) * 4;\r\n\t\t\tfor (var i: number = 0; i < 4; i++) {\r\n\t\t\t\tcolor[i] = pixels.data[offs + i];\r\n\t\t\t}\r\n\r\n\t\t\tfor (y = 0; y < h; y++) {\r\n\t\t\t\tfor (x = 0; x < w; x++) {\r\n\t\t\t\t\tvar index: number = (y * w + x) * 4;\r\n\t\t\t\t\tif (pixels.data[index] === color[0] && pixels.data[index + 1] === color[1] &&\r\n\t\t\t\t\t\tpixels.data[index + 2] === color[2] && pixels.data[index + 3] === color[3]) {\r\n\t\t\t\t\t\tpixels.data[index] = 0;\r\n\t\t\t\t\t\tpixels.data[index + 1] = 0;\r\n\t\t\t\t\t\tpixels.data[index + 2] = 0;\r\n\t\t\t\t\t\tpixels.data[index + 3] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tctx.putImageData(pixels, 0, 0);\r\n\t\t\treturn canvas;\r\n\t\t}\r\n\t}\r\n}\r\n"],"sourceRoot":"/source/"}