{"version":3,"sources":["gtp/Game.ts"],"names":["gtp","gtp.Game","gtp.Game.constructor","gtp.Game.start","gtp.Game._tick","gtp.Game.update","gtp.Game.render","gtp.Game.getGameTime","gtp.Game.getHeight","gtp.Game.getWidth","gtp.Game.randomInt","gtp.Game.setState","gtp.Game._renderStatusMessage","gtp.Game._renderFps","gtp.Game.setStatusMessage","gtp.Game.toggleShowFps","gtp.Game.clearScreen"],"mappings":"AAAA,IAAO,GAAG,CA2MT;AA3MD,WAAO,GAAG,EAAC,CAAC;IACXA,YAAYA,CAACA;IAEbA;;;;OAIGA;IACHA;QAwBCC,cAAYA,IAAcA;YAAdC,oBAAcA,GAAdA,SAAcA;YAT1BA,YAAOA,GAAYA,IAAIA,CAACA;YACxBA,WAAMA,GAAWA,CAACA,CAACA;YAUlBA,GAAGA,CAACA,KAAKA,CAACA,WAAWA,EAAEA,CAACA;YAExBA,IAAIA,CAACA,MAAMA,GAAGA,IAAIA,CAACA,KAAKA,IAAIA,CAACA,CAACA;YAC9BA,IAAIA,CAACA,MAAMA,GAAGA,GAAGA,CAACA,UAAUA,CAACA,YAAYA,CAACA,IAAIA,CAACA,KAAKA,EAAEA,IAAIA,CAACA,MAAMA,EAAEA,IAAIA,CAACA,MAAMA,CAACA,CAACA;YAEhFA,IAAIA,CAACA,YAAYA,GAAGA,IAAIA,GAAGA,CAACA,YAAYA,CAACA,IAAIA,CAACA,gBAAgBA,IAAIA,CAACA,CAACA,CAACA;YACrEA,IAAIA,CAACA,YAAYA,CAACA,OAAOA,EAAEA,CAACA;YAC5BA,IAAIA,CAACA,SAASA,GAAGA,CAACA,CAACA;YACnBA,IAAIA,CAACA,UAAUA,GAAGA,IAAIA,CAACA,SAASA,IAAIA,EAAEA,CAACA;YACvCA,IAAIA,CAACA,SAASA,GAAGA,IAAIA,GAAGA,IAAIA,CAACA,UAAUA,CAACA;YACxCA,IAAIA,CAACA,QAAQA,GAAGA,CAACA,CAACA;YAElBA,IAAIA,CAACA,KAAKA,GAAGA,IAAIA,GAAGA,CAACA,WAAWA,EAAEA,CAACA;YACnCA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,EAAEA,CAACA;YAClBA,IAAIA,WAAWA,GAAGA,IAAIA,CAACA,SAASA,IAAIA,IAAIA,CAACA;YACzCA,IAAIA,CAACA,MAAMA,GAAGA,IAAIA,GAAGA,CAACA,WAAWA,CAACA,IAAIA,CAACA,MAAMA,EAAEA,IAAIA,CAACA,KAAKA,EAAEA,WAAWA,CAACA,CAACA;YAExEA,IAAIA,CAACA,gBAAgBA,GAAGA,YAAYA,CAACA;YAErCA,IAAIA,CAACA,QAAQA,GAAGA,kBAAkBA,CAACA;YACnCA,IAAIA,CAACA,gBAAgBA,GAAGA,aAAaA,CAACA;YACtCA,IAAIA,CAACA,mBAAmBA,GAAGA,IAAIA,CAACA;YAChCA,IAAIA,CAACA,OAAOA,GAAGA,IAAIA,CAACA;YACpBA,IAAIA,CAACA,MAAMA,GAAGA,CAACA,CAACA;YAChBA,IAAIA,CAACA,OAAOA,GAAGA,IAAIA,CAACA,UAAUA,GAAGA,MAAMA,CAACA;YACxCA,IAAIA,CAACA,cAAcA,GAAGA,IAAIA,CAACA;YAC3BA,IAAIA,CAACA,mBAAmBA,GAAGA,CAACA,CAACA;YAE7BA,IAAIA,CAACA,KAAKA,GAAGA,IAAIA,GAAGA,CAACA,KAAKA,EAAEA,CAACA;QAC9BA,CAACA;QAEDD;;WAEGA;QACHA,oBAAKA,GAALA;YACCE,2BAA2BA;YAC3BA,IAAIA,IAAIA,GAAGA,IAAIA,CAACA;YAChBA,IAAIA,QAAQA,GAAGA;gBACd,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC;gBACjC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YACxB,CAAC,CAACA;YACFA,WAAWA,CAACA,QAAQA,EAAEA,IAAIA,CAACA,SAASA,CAACA,CAACA;QACvCA,CAACA;QAEOF,oBAAKA,GAAbA;YAECG,EAAEA,CAACA,CAACA,IAAIA,CAACA,cAAcA,CAACA,CAACA,CAACA;gBACzBA,IAAIA,IAAIA,GAAGA,IAAIA,IAAIA,EAAEA,CAACA,OAAOA,EAAEA,CAACA;gBAChCA,EAAEA,CAACA,CAACA,IAAIA,GAAGA,IAAIA,CAACA,kBAAkBA,CAACA,CAACA,CAACA;oBACpCA,IAAIA,CAACA,kBAAkBA,GAAGA,IAAIA,GAAGA,GAAGA,CAACA;oBACrCA,IAAIA,CAACA,mBAAmBA,IAAIA,GAAGA,CAACA;oBAChCA,IAAIA,KAAKA,GAAGA,IAAIA,CAACA,GAAGA,CAACA,CAACA,EAAEA,IAAIA,CAACA,mBAAmBA,CAACA,CAACA;oBAClDA,IAAIA,CAACA,mBAAmBA,GAAGA,OAAOA,GAAGA,IAAIA,CAACA,gBAAgBA,GAAGA,GAAGA,GAAGA,KAAKA,GAAGA,GAAGA,CAACA;oBAC/EA,EAAEA,CAACA,CAACA,IAAIA,CAACA,mBAAmBA,IAAIA,CAACA,CAACA,CAACA,CAACA;wBACnCA,IAAIA,CAACA,cAAcA,GAAGA,IAAIA,CAACA;oBAC5BA,CAACA;gBACFA,CAACA;YACFA,CAACA;YAEDA,IAAIA,CAACA,MAAMA,EAAEA,CAACA;YACdA,IAAIA,CAACA,MAAMA,EAAEA,CAACA;QACfA,CAACA;QAEDH;;;;;WAKGA;QACHA,qBAAMA,GAANA;YAECI,IAAIA,EAAEA,GAAGA,IAAIA,CAACA,YAAYA,CAACA;YAC3BA,EAAEA,CAACA,CAACA,EAAEA,CAACA,SAASA,CAACA,GAAGA,CAACA,IAAIA,CAACA,SAASA,CAACA,CAACA,CAACA,CAACA;gBAEtCA,EAAEA,CAACA,CAACA,EAAEA,CAACA,SAASA,CAACA,GAAGA,CAACA,IAAIA,CAACA,KAAKA,EAAEA,IAAIA,CAACA,CAACA,CAACA,CAACA;oBACxCA,IAAIA,CAACA,aAAaA,EAAEA,CAACA;gBACtBA,CAACA;YAEFA,CAACA;YACDA,IAAIA,CAACA,KAAKA,CAACA,MAAMA,CAACA,IAAIA,CAACA,SAASA,CAACA,CAACA;QAEnCA,CAACA;QAEDJ,qBAAMA,GAANA;YAECK,IAAIA,GAAGA,GAAGA,IAAIA,CAACA,MAAMA,CAACA,UAAUA,CAACA,IAAIA,CAACA,CAACA;YACvCA,IAAIA,CAACA,KAAKA,CAACA,MAAMA,CAACA,GAAGA,CAACA,CAACA;YAEvBA,EAAEA,CAACA,CAACA,IAAIA,CAACA,OAAOA,CAACA,CAACA,CAACA;gBAClBA,IAAIA,CAACA,UAAUA,CAACA,GAAGA,CAACA,CAACA;YACtBA,CAACA;YACDA,EAAEA,CAACA,CAACA,IAAIA,CAACA,cAAcA,IAAIA,IAAIA,CAACA,mBAAmBA,GAAGA,CAACA,CAACA,CAACA,CAACA;gBACzDA,IAAIA,CAACA,oBAAoBA,CAACA,GAAGA,CAACA,CAACA;YAChCA,CAACA;QACFA,CAACA;QAEDL,0BAAWA,GAAXA;YACCM,MAAMA,CAACA,IAAIA,CAACA,SAASA,CAACA;QACvBA,CAACA;QAEDN,wBAASA,GAATA;YACCO,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,MAAMA,CAACA;QAC3BA,CAACA;QAEDP,uBAAQA,GAARA;YACCQ,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,KAAKA,CAACA;QAC1BA,CAACA;QAEDR,wBAASA,GAATA,UAAUA,GAAWA;YACpBS,IAAIA,GAAGA,GAAGA,CAACA,CAACA;YACZA,4DAA4DA;YAC5DA,MAAMA,CAACA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,CAACA,MAAMA,EAAEA,GAAGA,CAACA,GAAGA,GAAGA,GAAGA,GAAGA,CAACA,CAACA,GAAGA,GAAGA,CAACA,CAACA;QAC1DA,CAACA;QAEDT,uBAAQA,GAARA,UAASA,KAAgBA;YACxBU,EAAEA,CAACA,CAACA,IAAIA,CAACA,KAAKA,CAACA,CAACA,CAACA;gBAChBA,IAAIA,CAACA,KAAKA,CAACA,OAAOA,CAACA,IAAIA,CAACA,CAACA;YAC1BA,CAACA;YACDA,IAAIA,CAACA,KAAKA,GAAGA,KAAKA,CAACA;YACnBA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,EAAEA,CAACA;QACnBA,CAACA;QAEOV,mCAAoBA,GAA5BA,UAA6BA,GAA6BA;YACzDW,IAAIA,CAACA,GAAGA,EAAEA,CAACA;YACXA,IAAIA,CAACA,GAAGA,IAAIA,CAACA,MAAMA,CAACA,MAAMA,GAAGA,EAAEA,CAACA;YAChCA,GAAGA,CAACA,IAAIA,GAAGA,kBAAkBA,CAACA,CAAAA,eAAeA;YAC7CA,GAAGA,CAACA,SAASA,GAAGA,IAAIA,CAACA,mBAAmBA,CAACA;YACzCA,GAAGA,CAACA,QAAQA,CAACA,IAAIA,CAACA,cAAcA,EAAEA,CAACA,EAAEA,CAACA,CAACA,CAACA;QACzCA,CAACA;QAEOX,yBAAUA,GAAlBA,UAAmBA,GAA6BA;YAE/CY,IAAIA,CAACA,MAAMA,EAAEA,CAACA;YACdA,IAAIA,GAAGA,GAAGA,IAAIA,IAAIA,EAAEA,CAACA,OAAOA,EAAEA,CAACA;YAC/BA,EAAEA,CAACA,CAACA,IAAIA,CAACA,QAAQA,KAAKA,IAAIA,CAACA,CAACA,CAACA;gBAC5BA,IAAIA,CAACA,QAAQA,GAAGA,GAAGA,CAACA;YACrBA,CAACA;YACDA,IAAIA,CAACA,EAAEA,CAACA,CAACA,GAAGA,GAAGA,IAAIA,CAACA,QAAQA,IAAIA,IAAIA,CAACA,CAACA,CAACA;gBACtCA,IAAIA,CAACA,OAAOA,GAAGA,IAAIA,CAACA,MAAMA,GAAGA,MAAMA,CAACA;gBACpCA,IAAIA,CAACA,MAAMA,GAAGA,CAACA,CAACA;gBAChBA,IAAIA,CAACA,QAAQA,GAAGA,GAAGA,CAACA;YACrBA,CAACA;YAEDA,IAAIA,CAACA,GAAGA,EAAEA,CAACA;YACXA,IAAIA,CAACA,GAAGA,EAAEA,CAACA;YACXA,GAAGA,CAACA,IAAIA,GAAGA,YAAYA,CAACA;YACxBA,GAAGA,CAACA,SAASA,GAAGA,IAAIA,CAACA,QAAQA,CAACA;YAC9BA,GAAGA,CAACA,QAAQA,CAACA,IAAIA,CAACA,OAAOA,EAAEA,CAACA,EAAEA,CAACA,CAACA,CAACA;QAElCA,CAACA;QAEDZ,+BAAgBA,GAAhBA,UAAiBA,OAAeA;YAC/Ba,IAAIA,CAACA,cAAcA,GAAGA,OAAOA,CAACA;YAC9BA,IAAIA,CAACA,mBAAmBA,GAAGA,GAAGA,CAACA,CAACA,oCAAoCA;YACpEA,IAAIA,CAACA,kBAAkBA,GAAGA,IAAIA,IAAIA,EAAEA,CAACA,OAAOA,EAAEA,GAAGA,GAAGA,CAACA;QACtDA,CAACA;QAEDb,4BAAaA,GAAbA;YACCc,IAAIA,CAACA,OAAOA,GAAGA,CAACA,IAAIA,CAACA,OAAOA,CAACA;YAC7BA,IAAIA,CAACA,gBAAgBA,CAACA,eAAeA,GAAGA,CAACA,IAAIA,CAACA,OAAOA,GAAGA,IAAIA,GAAGA,KAAKA,CAACA,CAACA,CAACA;QACxEA,CAACA;QAEDd,0BAAWA,GAAXA,UAAYA,gBAAgDA;YAAhDe,gCAAgDA,GAAhDA,mBAA2BA,IAAIA,CAACA,gBAAgBA;YAC3DA,IAAIA,GAAGA,GAAGA,IAAIA,CAACA,MAAMA,CAACA,UAAUA,CAACA,IAAIA,CAACA,CAACA;YACvCA,GAAGA,CAACA,SAASA,GAAGA,gBAAgBA,CAACA;YACjCA,GAAGA,CAACA,QAAQA,CAACA,CAACA,EAAEA,CAACA,EAAEA,IAAIA,CAACA,QAAQA,EAAEA,EAAEA,IAAIA,CAACA,SAASA,EAAEA,CAACA,CAACA;QACvDA,CAACA;QAEFf,WAACA;IAADA,CAlMAD,AAkMCC,IAAAD;IAlMYA,QAAIA,OAkMhBA,CAAAA;AACFA,CAACA,EA3MM,GAAG,KAAH,GAAG,QA2MT","file":"gtp/Game.js","sourcesContent":["module gtp {\r\n\t'use strict';\r\n\t\r\n\t/**\r\n\t * A base class for a game.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\texport class Game {\r\n\r\n\t\t/*private */_scale: number;\r\n\t\tcanvas: HTMLCanvasElement;\r\n\t\tinputManager: gtp.InputManager;\r\n\t\t_gameTime: number;\r\n\t\t_targetFps: number;\r\n\t\t_interval: number;\r\n\t\tlastTime: number;\r\n\t\taudio: gtp.AudioSystem;\r\n\t\tassets: gtp.AssetLoader;\r\n\t\tclearScreenColor: string;\r\n\t\tfpsColor: string;\r\n\t\tstatusMessageRGB: string;\r\n\t\tprivate _statusMessageColor: string;\r\n\t\tshowFps: boolean = true;\r\n\t\tframes: number = 0;\r\n\t\tprivate _fpsMsg: string;\r\n\t\tprivate _statusMessage: string;\r\n\t\tprivate _statusMessageAlpha: number;\r\n\t\tprivate _statusMessageTime: number;\r\n\t\tstate: gtp.State;\r\n\t\ttimer: gtp.Timer;\r\n\r\n\t\tconstructor(args: any = {}) {\r\n\r\n\t\t\tgtp.Utils.initConsole();\r\n\r\n\t\t\tthis._scale = args.scale || 1;\r\n\t\t\tthis.canvas = gtp.ImageUtils.createCanvas(args.width, args.height, args.parent);\r\n\r\n\t\t\tthis.inputManager = new gtp.InputManager(args.keyRefreshMillis || 0);\r\n\t\t\tthis.inputManager.install();\r\n\t\t\tthis._gameTime = 0;\r\n\t\t\tthis._targetFps = args.targetFps || 30;\r\n\t\t\tthis._interval = 1000 / this._targetFps;\r\n\t\t\tthis.lastTime = 0;\r\n\r\n\t\t\tthis.audio = new gtp.AudioSystem();\r\n\t\t\tthis.audio.init();\r\n\t\t\tvar assetPrefix = args.assetRoot || null;\r\n\t\t\tthis.assets = new gtp.AssetLoader(this._scale, this.audio, assetPrefix);\r\n\r\n\t\t\tthis.clearScreenColor = 'rgb(0,0,0)';\r\n\r\n\t\t\tthis.fpsColor = 'rgb(255,255,255)';\r\n\t\t\tthis.statusMessageRGB = '255,255,255';\r\n\t\t\tthis._statusMessageColor = null;\r\n\t\t\tthis.showFps = true;\r\n\t\t\tthis.frames = 0;\r\n\t\t\tthis._fpsMsg = this._targetFps + ' fps';\r\n\t\t\tthis._statusMessage = null;\r\n\t\t\tthis._statusMessageAlpha = 0;\r\n\r\n\t\t\tthis.timer = new gtp.Timer();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Starts the game loop.\r\n\t\t */\r\n\t\tstart() {\r\n\t\t\t// e.g. Dojo's lang.hitch()\r\n\t\t\tvar self = this;\r\n\t\t\tvar callback = function() {\r\n\t\t\t\tself._gameTime += self._interval;\r\n\t\t\t\tself._tick.apply(self);\r\n\t\t\t};\r\n\t\t\tsetInterval(callback, this._interval);\r\n\t\t}\r\n   \r\n\t\tprivate _tick() {\r\n\r\n\t\t\tif (this._statusMessage) {\r\n\t\t\t\tvar time = new Date().getTime();\r\n\t\t\t\tif (time > this._statusMessageTime) {\r\n\t\t\t\t\tthis._statusMessageTime = time + 100;\r\n\t\t\t\t\tthis._statusMessageAlpha -= 0.1;\r\n\t\t\t\t\tvar alpha = Math.min(1, this._statusMessageAlpha);\r\n\t\t\t\t\tthis._statusMessageColor = 'rgba(' + this.statusMessageRGB + ',' + alpha + ')';\r\n\t\t\t\t\tif (this._statusMessageAlpha <= 0) {\r\n\t\t\t\t\t\tthis._statusMessage = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.update();\r\n\t\t\tthis.render();\r\n\t\t}\r\n   \r\n\t\t/**\r\n\t\t * Called during each tick to update game logic.  The default implementation\r\n\t\t * checks for a shortcut key to toggle the FPS display before delegating to\r\n\t\t * the current game state.  Subclasses can override, but typically update\r\n\t\t * logic is handled by game states.\r\n\t\t */\r\n\t\tupdate() {\r\n\r\n\t\t\tvar im = this.inputManager;\r\n\t\t\tif (im.isKeyDown(gtp.Keys.KEY_SHIFT)) {\r\n\r\n\t\t\t\tif (im.isKeyDown(gtp.Keys.KEY_F, true)) {\r\n\t\t\t\t\tthis.toggleShowFps();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis.state.update(this._interval);\r\n\r\n\t\t}\r\n   \r\n\t\trender() {\r\n\r\n\t\t\tvar ctx = this.canvas.getContext('2d');\r\n\t\t\tthis.state.render(ctx);\r\n\r\n\t\t\tif (this.showFps) {\r\n\t\t\t\tthis._renderFps(ctx);\r\n\t\t\t}\r\n\t\t\tif (this._statusMessage && this._statusMessageAlpha > 0) {\r\n\t\t\t\tthis._renderStatusMessage(ctx);\r\n\t\t\t}\r\n\t\t}\r\n   \r\n\t\tgetGameTime() : number {\r\n\t\t\treturn this._gameTime;\r\n\t\t}\r\n   \r\n\t\tgetHeight() : number {\r\n\t\t\treturn this.canvas.height;\r\n\t\t}\r\n   \r\n\t\tgetWidth() : number {\r\n\t\t\treturn this.canvas.width;\r\n\t\t}\r\n   \r\n\t\trandomInt(max: number) : number {\r\n\t\t\tvar min = 0;\r\n\t\t\t// Using Math.round() would give a non-uniform distribution!\r\n\t\t\treturn Math.floor(Math.random() * (max - min + 1) + min);\r\n\t\t}\r\n   \r\n\t\tsetState(state: gtp.State) {\r\n\t\t\tif (this.state) {\r\n\t\t\t\tthis.state.leaving(this);\r\n\t\t\t}\r\n\t\t\tthis.state = state;\r\n\t\t\tthis.state.init();\r\n\t\t}\r\n   \r\n\t\tprivate _renderStatusMessage(ctx: CanvasRenderingContext2D) {\r\n\t\t\tvar x = 10;\r\n\t\t\tvar y = this.canvas.height - 30;\r\n\t\t\tctx.font = 'Dragon Warrior 2';//'10pt Arial';\r\n\t\t\tctx.fillStyle = this._statusMessageColor;\r\n\t\t\tctx.fillText(this._statusMessage, x, y);\r\n\t\t}\r\n   \r\n\t\tprivate _renderFps(ctx: CanvasRenderingContext2D) {\r\n\r\n\t\t\tthis.frames++;\r\n\t\t\tvar now = new Date().getTime();\r\n\t\t\tif (this.lastTime === null) {\r\n\t\t\t\tthis.lastTime = now;\r\n\t\t\t}\r\n\t\t\telse if (now - this.lastTime >= 1000) {\r\n\t\t\t\tthis._fpsMsg = this.frames + ' fps';\r\n\t\t\t\tthis.frames = 0;\r\n\t\t\t\tthis.lastTime = now;\r\n\t\t\t}\r\n\r\n\t\t\tvar x = 10;\r\n\t\t\tvar y = 15;\r\n\t\t\tctx.font = '10pt Arial';\r\n\t\t\tctx.fillStyle = this.fpsColor;\r\n\t\t\tctx.fillText(this._fpsMsg, x, y);\r\n\r\n\t\t}\r\n   \r\n\t\tsetStatusMessage(message: string) {\r\n\t\t\tthis._statusMessage = message;\r\n\t\t\tthis._statusMessageAlpha = 2.0; // 1.0 of message, 1.0 of fading out\r\n\t\t\tthis._statusMessageTime = new Date().getTime() + 100;\r\n\t\t}\r\n   \r\n\t\ttoggleShowFps() {\r\n\t\t\tthis.showFps = !this.showFps;\r\n\t\t\tthis.setStatusMessage('FPS display: ' + (this.showFps ? 'on' : 'off'));\r\n\t\t}\r\n   \r\n\t\tclearScreen(clearScreenColor: string = this.clearScreenColor) {\r\n\t\t\tvar ctx = this.canvas.getContext('2d');\r\n\t\t\tctx.fillStyle = clearScreenColor;\r\n\t\t\tctx.fillRect(0, 0, this.getWidth(), this.getHeight());\r\n\t\t}\r\n\r\n\t}\r\n}"],"sourceRoot":"/source/"}